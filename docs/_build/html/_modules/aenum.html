

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>aenum &mdash; gs_quant 0.1 documentation</title>
  

    
  <script crossorigin src="/resources/react/16-8-6/prod/react.production.min.js"></script>
  <script
    crossorigin src="/resources/react/16-8-6/prod/react-dom.production.min.js"></script>

     
    <script src='/resources/mathjax/latest.js?config=TeX-AMS-MML_HTMLorMML' async></script> 
    
    <script type="text/javascript" src="../_static/../../../auto-mount.js"></script>
    <link rel="stylesheet" href="../_static/../../../auto-mount.css" type="text/css" />

  
  
  
  

  
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" /> 
</head>

<!-- Hello from the future. -->
<div id="mq-doc-navbar-inject"></div>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    <a data-toggle="wy-nav-top" id="gs-developer-action-button-container" ontouchstart="">
      <div data-toggle="gs-nav-action" id="gs-nav-action"></div>
    </a>
    
    <nav id="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        
        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Packages</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../data.html">Data Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../datetime.html">Datetime Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../instrument.html">Instrument Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../markets.html">Markets Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models.html">Models Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../risk.html">Risk Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timeseries.html">Timeseries Package</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Packages</a> /</li>
        
          <li><a href="index.html">Module code</a> /</li>
        
      <li>aenum</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for aenum</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Python Advanced Enumerations &amp; NameTuples&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">sys</span> <span class="k">as</span> <span class="nn">_sys</span>
<span class="n">pyver</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">_sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>

<span class="kn">import</span> <span class="nn">re</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">OrderedDict</span> <span class="o">=</span> <span class="nb">dict</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">sqlite3</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">if</span> <span class="n">pyver</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">reduce</span>

<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">or_</span> <span class="k">as</span> <span class="n">_or_</span><span class="p">,</span> <span class="n">and_</span> <span class="k">as</span> <span class="n">_and_</span><span class="p">,</span> <span class="n">xor</span> <span class="k">as</span> <span class="n">_xor_</span><span class="p">,</span> <span class="n">inv</span> <span class="k">as</span> <span class="n">_inv_</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="nb">abs</span> <span class="k">as</span> <span class="n">_abs_</span><span class="p">,</span> <span class="n">add</span> <span class="k">as</span> <span class="n">_add_</span><span class="p">,</span> <span class="n">floordiv</span> <span class="k">as</span> <span class="n">_floordiv_</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">lshift</span> <span class="k">as</span> <span class="n">_lshift_</span><span class="p">,</span> <span class="n">rshift</span> <span class="k">as</span> <span class="n">_rshift_</span><span class="p">,</span> <span class="n">mod</span> <span class="k">as</span> <span class="n">_mod_</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">mul</span> <span class="k">as</span> <span class="n">_mul_</span><span class="p">,</span> <span class="n">neg</span> <span class="k">as</span> <span class="n">_neg_</span><span class="p">,</span> <span class="n">pos</span> <span class="k">as</span> <span class="n">_pos_</span><span class="p">,</span> <span class="nb">pow</span> <span class="k">as</span> <span class="n">_pow_</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">truediv</span> <span class="k">as</span> <span class="n">_truediv_</span><span class="p">,</span> <span class="n">sub</span> <span class="k">as</span> <span class="n">_sub_</span>
<span class="k">if</span> <span class="n">pyver</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">div</span> <span class="k">as</span> <span class="n">_div_</span>

<span class="k">if</span> <span class="n">pyver</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">getfullargspec</span>
    <span class="k">def</span> <span class="nf">getargspec</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
        <span class="n">args</span><span class="p">,</span> <span class="n">varargs</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">defaults</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">getfullargspec</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">args</span><span class="p">,</span> <span class="n">varargs</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">defaults</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">getargspec</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;NamedConstant&#39;</span><span class="p">,</span> <span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="s1">&#39;skip&#39;</span><span class="p">,</span> <span class="s1">&#39;nonmember&#39;</span><span class="p">,</span> <span class="s1">&#39;member&#39;</span><span class="p">,</span> <span class="s1">&#39;no_arg&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Enum&#39;</span><span class="p">,</span> <span class="s1">&#39;IntEnum&#39;</span><span class="p">,</span> <span class="s1">&#39;AutoNumberEnum&#39;</span><span class="p">,</span> <span class="s1">&#39;OrderedEnum&#39;</span><span class="p">,</span> <span class="s1">&#39;UniqueEnum&#39;</span><span class="p">,</span>
        <span class="s1">&#39;StrEnum&#39;</span><span class="p">,</span> <span class="s1">&#39;UpperStrEnum&#39;</span><span class="p">,</span> <span class="s1">&#39;LowerStrEnum&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Flag&#39;</span><span class="p">,</span> <span class="s1">&#39;IntFlag&#39;</span><span class="p">,</span>
        <span class="s1">&#39;AutoNumber&#39;</span><span class="p">,</span> <span class="s1">&#39;MultiValue&#39;</span><span class="p">,</span> <span class="s1">&#39;NoAlias&#39;</span><span class="p">,</span> <span class="s1">&#39;Unique&#39;</span><span class="p">,</span>
        <span class="s1">&#39;enum&#39;</span><span class="p">,</span> <span class="s1">&#39;extend_enum&#39;</span><span class="p">,</span> <span class="s1">&#39;unique&#39;</span><span class="p">,</span> <span class="s1">&#39;enum_property&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NamedTuple&#39;</span><span class="p">,</span> <span class="s1">&#39;SqliteEnum&#39;</span><span class="p">,</span>
        <span class="p">]</span>
<span class="k">if</span> <span class="n">sqlite3</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">__all__</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;SqliteEnum&#39;</span><span class="p">)</span>

<span class="n">version</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span>

<span class="k">try</span><span class="p">:</span>
    <span class="nb">any</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">any</span><span class="p">(</span><span class="n">iterable</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">iterable</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">element</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">basestring</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="c1"># In Python 2 basestring is the ancestor of both str and unicode</span>
    <span class="c1"># in Python 3 it&#39;s just str, but was missing in 3.1</span>
    <span class="n">basestring</span> <span class="o">=</span> <span class="nb">str</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">unicode</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="c1"># In Python 3 unicode no longer exists (it&#39;s just str)</span>
    <span class="n">unicode</span> <span class="o">=</span> <span class="nb">str</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">long</span>
    <span class="n">baseinteger</span> <span class="o">=</span> <span class="nb">int</span><span class="p">,</span> <span class="n">long</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="n">baseinteger</span> <span class="o">=</span> <span class="nb">int</span>
<span class="c1"># deprecated</span>
<span class="n">baseint</span> <span class="o">=</span> <span class="n">baseinteger</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">NoneType</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="n">NoneType</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># derive from stdlib enum if possible</span>
    <span class="kn">import</span> <span class="nn">enum</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">enum</span><span class="p">,</span> <span class="s1">&#39;version&#39;</span><span class="p">):</span>
        <span class="n">StdlibEnumMeta</span> <span class="o">=</span> <span class="n">StdlibEnum</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">EnumMeta</span> <span class="k">as</span> <span class="n">StdlibEnumMeta</span><span class="p">,</span> <span class="n">Enum</span> <span class="k">as</span> <span class="n">StdlibEnum</span>
    <span class="k">del</span> <span class="n">enum</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">StdlibEnumMeta</span> <span class="o">=</span> <span class="n">StdlibEnum</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># will be exported later</span>
<span class="n">AutoValue</span> <span class="o">=</span> <span class="n">AutoNumber</span> <span class="o">=</span> <span class="n">MultiValue</span> <span class="o">=</span> <span class="n">NoAlias</span> <span class="o">=</span> <span class="n">Unique</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">class</span> <span class="nc">enum_property</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a descriptor, used to define attributes that act differently</span>
<span class="sd">    when accessed through an enum member and through an enum class.</span>
<span class="sd">    Instance access is the same as property(), but access to an attribute</span>
<span class="sd">    through the enum class will look in the class&#39; _member_map_.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fget</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fget</span> <span class="o">=</span> <span class="n">fget</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">doc</span> <span class="ow">or</span> <span class="n">fget</span><span class="o">.</span><span class="vm">__doc__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fget</span> <span class="o">=</span> <span class="n">func</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__doc__</span> <span class="ow">or</span> <span class="n">doc</span> <span class="ow">or</span> <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span>

    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">ownerclass</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ownerclass</span><span class="o">.</span><span class="n">_member_map_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%r</span><span class="s1"> not found in </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">ownerclass</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fget</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># search through mro</span>
                <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">ownerclass</span><span class="o">.</span><span class="vm">__mro__</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">base</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
                        <span class="n">attr</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%r</span><span class="s1"> not found in </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">instance</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="nb">classmethod</span><span class="p">):</span>
                    <span class="n">attr</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="vm">__func__</span>
                    <span class="k">return</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">:</span> <span class="n">attr</span><span class="p">(</span><span class="n">ownerclass</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="nb">staticmethod</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">attr</span><span class="o">.</span><span class="vm">__func__</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="p">(</span><span class="nb">property</span><span class="p">,</span> <span class="n">enum_property</span><span class="p">)):</span>
                    <span class="k">return</span> <span class="n">attr</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">ownerclass</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">attr</span><span class="p">):</span>
                    <span class="k">return</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">:</span> <span class="n">attr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">attr</span>

    <span class="k">def</span> <span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">ownerclass</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">ownerclass</span><span class="o">.</span><span class="vm">__mro__</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">base</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
                <span class="n">attr</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="nb">property</span><span class="p">):</span>
                    <span class="n">setter</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="fm">__set__</span>
                    <span class="k">if</span> <span class="n">setter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">setter</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;can&#39;t set attribute </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">))</span>

    <span class="k">def</span> <span class="fm">__delete__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;can&#39;t delete attribute </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">))</span>

<span class="n">_RouteClassAttributeToGetattr</span> <span class="o">=</span> <span class="n">enum_property</span>

<span class="k">class</span> <span class="nc">NonMember</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Protects item from becoming an Enum member during class creation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">ownerclass</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
<span class="n">skip</span> <span class="o">=</span> <span class="n">nonmember</span> <span class="o">=</span> <span class="n">NonMember</span>

<span class="k">class</span> <span class="nc">Member</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Forces item to became an Enum member during class creation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
<span class="n">member</span> <span class="o">=</span> <span class="n">Member</span>


<span class="k">def</span> <span class="nf">_is_descriptor</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns True if obj is a descriptor, False otherwise.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
            <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;__get__&#39;</span><span class="p">)</span> <span class="ow">or</span>
            <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;__set__&#39;</span><span class="p">)</span> <span class="ow">or</span>
            <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;__delete__&#39;</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_is_dunder</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns True if a __dunder__ name, False otherwise.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="ow">and</span>
            <span class="n">name</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;__&#39;</span> <span class="ow">and</span>
            <span class="n">name</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;_&#39;</span> <span class="ow">and</span>
            <span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_is_sunder</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns True if a _sunder_ name, False otherwise.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span>
            <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span> <span class="ow">and</span>
            <span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;_&#39;</span> <span class="ow">and</span>
            <span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_is_internal_class</span><span class="p">(</span><span class="n">cls_name</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
    <span class="c1"># only 3.3 and up, always return False in 3.2 and below</span>
    <span class="k">if</span> <span class="n">pyver</span> <span class="o">&lt;</span> <span class="mf">3.3</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">qualname</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;__qualname__&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="n">_is_descriptor</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">and</span> <span class="n">qualname</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\.?</span><span class="si">%s</span><span class="s2">\.\w+$&quot;</span> <span class="o">%</span> <span class="n">cls_name</span><span class="p">,</span> <span class="n">qualname</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_make_class_unpicklable</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Make the given class un-picklable.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_break_on_call_reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%r</span><span class="s1"> cannot be pickled&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">))</span>
    <span class="bp">cls</span><span class="o">.</span><span class="n">__reduce_ex__</span> <span class="o">=</span> <span class="n">_break_on_call_reduce</span>
    <span class="bp">cls</span><span class="o">.</span><span class="vm">__module__</span> <span class="o">=</span> <span class="s1">&#39;&lt;unknown&gt;&#39;</span>

<span class="k">def</span> <span class="nf">_check_auto_args</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;check if new generate method supports *args and **kwds&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="nb">staticmethod</span><span class="p">):</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span>
    <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s1">&#39;im_func&#39;</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
    <span class="n">args</span><span class="p">,</span> <span class="n">varargs</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">defaults</span> <span class="o">=</span> <span class="n">getargspec</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">varargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">keywords</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">_get_attr_from_chain</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
    <span class="n">sentinel</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">basecls</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">mro</span><span class="p">():</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">basecls</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">sentinel</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">sentinel</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">obj</span>

<span class="k">def</span> <span class="nf">_value</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">auto</span><span class="p">,</span> <span class="n">constant</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">value</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">obj</span>

<span class="c1">################</span>
<span class="c1"># Constant stuff</span>
<span class="c1">################</span>

<span class="c1"># metaclass and class dict for NamedConstant</span>

<span class="k">class</span> <span class="nc">constant</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Simple constant descriptor for NamedConstant and Enum use.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">doc</span>

    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%r</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_and_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">_value</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__rand__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_and_</span><span class="p">(</span><span class="n">_value</span><span class="p">(</span><span class="n">other</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__invert__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_inv_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_or_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">_value</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__ror__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_or_</span><span class="p">(</span><span class="n">_value</span><span class="p">(</span><span class="n">other</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__xor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_xor_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">_value</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__rxor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_xor_</span><span class="p">(</span><span class="n">_value</span><span class="p">(</span><span class="n">other</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_abs_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_add_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">_value</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_add_</span><span class="p">(</span><span class="n">_value</span><span class="p">(</span><span class="n">other</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_neg_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_pos_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pyver</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_div_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">_value</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__rdiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_div_</span><span class="p">(</span><span class="n">_value</span><span class="p">(</span><span class="n">other</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__floordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_floordiv_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">_value</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__rfloordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_floordiv_</span><span class="p">(</span><span class="n">_value</span><span class="p">(</span><span class="n">other</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_truediv_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">_value</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_truediv_</span><span class="p">(</span><span class="n">_value</span><span class="p">(</span><span class="n">other</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__lshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_lshift_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">_value</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__rlshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_lshift_</span><span class="p">(</span><span class="n">_value</span><span class="p">(</span><span class="n">other</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__rshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_rshift_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">_value</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__rrshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_rshift_</span><span class="p">(</span><span class="n">_value</span><span class="p">(</span><span class="n">other</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__mod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_mod_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">_value</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__rmod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_mod_</span><span class="p">(</span><span class="n">_value</span><span class="p">(</span><span class="n">other</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_mul_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">_value</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_mul_</span><span class="p">(</span><span class="n">_value</span><span class="p">(</span><span class="n">other</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_pow_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">_value</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__rpow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_pow_</span><span class="p">(</span><span class="n">_value</span><span class="p">(</span><span class="n">other</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_sub_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">_value</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_sub_</span><span class="p">(</span><span class="n">_value</span><span class="p">(</span><span class="n">other</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>



<span class="n">NamedConstant</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">class</span> <span class="nc">_NamedConstantDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Track constant order and ensure names are not reused.</span>

<span class="sd">    NamedConstantMeta will use the names found in self._names as the</span>
<span class="sd">    Constant names.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_NamedConstantDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_names</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Changes anything not dundered or not a constant descriptor.</span>

<span class="sd">        If an constant name is used twice, an error is raised; duplicate</span>
<span class="sd">        values are not checked for.</span>

<span class="sd">        Single underscore (sunder) names are reserved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">_is_sunder</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;_names_ are reserved for future NamedConstant use&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">_is_dunder</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">:</span>
            <span class="c1"># overwriting an existing constant?</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;attempt to reuse name: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">constant</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">_is_descriptor</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="c1"># overwriting a descriptor?</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> already defined as: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_NamedConstantDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">NamedConstantMeta</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Block attempts to reassign NamedConstant attributes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">metacls</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">clsdict</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">clsdict</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="n">original_dict</span> <span class="o">=</span> <span class="n">clsdict</span>
            <span class="n">clsdict</span> <span class="o">=</span> <span class="n">_NamedConstantDict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">original_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">clsdict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="n">newdict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">constants</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">clsdict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">clsdict</span><span class="o">.</span><span class="n">_names</span><span class="p">:</span>
                <span class="n">constants</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">nonmember</span><span class="p">):</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">value</span>
            <span class="n">newdict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>
        <span class="n">newcls</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">NamedConstantMeta</span><span class="p">,</span> <span class="n">metacls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">metacls</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">newdict</span><span class="p">)</span>
        <span class="n">newcls</span><span class="o">.</span><span class="n">_named_constant_cache_</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">newcls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">newcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">newcls</span>

    <span class="k">def</span> <span class="fm">__delattr__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="n">cur_obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">NamedConstant</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cur_obj</span><span class="p">,</span> <span class="n">NamedConstant</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;cannot delete constant &lt;</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cur_obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">cur_obj</span><span class="o">.</span><span class="n">_name_</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NamedConstantMeta</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__delattr__</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Block attempts to reassign NamedConstants.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cur_obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">NamedConstant</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cur_obj</span><span class="p">,</span> <span class="n">NamedConstant</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;cannot rebind constant &lt;</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cur_obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">cur_obj</span><span class="o">.</span><span class="n">_name_</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NamedConstantMeta</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<span class="n">temp_constant_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">temp_constant_dict</span><span class="p">[</span><span class="s1">&#39;__doc__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NamedConstants protection.</span><span class="se">\n\n</span><span class="s2">    Derive from this class to lock NamedConstants.</span><span class="se">\n\n</span><span class="s2">&quot;</span>

<span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># lookup, name is value</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">_value_</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">obj</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%r</span><span class="s1"> does not exist in </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
    <span class="n">cur_obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cur_obj</span><span class="p">,</span> <span class="n">NamedConstant</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;cannot rebind constant &lt;</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cur_obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">cur_obj</span><span class="o">.</span><span class="n">_name_</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">constant</span><span class="p">):</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">doc</span> <span class="ow">or</span> <span class="n">value</span><span class="o">.</span><span class="vm">__doc__</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">value</span>
    <span class="n">metacls</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__class__</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">NamedConstant</span><span class="p">):</span>
        <span class="c1"># constants from other classes are reduced to their actual value</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">_value_</span>
    <span class="n">actual_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">value_type</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_named_constant_cache_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">actual_type</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">value_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">value_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)),</span> <span class="p">{})</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_named_constant_cache_</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span> <span class="o">=</span> <span class="n">value_type</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">actual_type</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">value_type</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">_name_</span> <span class="o">=</span> <span class="n">name</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">_value_</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">obj</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">doc</span>
    <span class="n">metacls</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">obj</span>
<span class="n">temp_constant_dict</span><span class="p">[</span><span class="s1">&#39;__new__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="fm">__new__</span>
<span class="k">del</span> <span class="fm">__new__</span>

<span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">: </span><span class="si">%r</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value_</span><span class="p">)</span>
<span class="n">temp_constant_dict</span><span class="p">[</span><span class="s1">&#39;__repr__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="fm">__repr__</span>
<span class="k">del</span> <span class="fm">__repr__</span>

<span class="k">def</span> <span class="nf">__reduce_ex__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proto</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name_</span><span class="p">)</span>
<span class="n">temp_constant_dict</span><span class="p">[</span><span class="s1">&#39;__reduce_ex__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">__reduce_ex__</span>
<span class="k">del</span> <span class="n">__reduce_ex__</span>


<span class="n">NamedConstant</span> <span class="o">=</span> <span class="n">NamedConstantMeta</span><span class="p">(</span><span class="s1">&#39;NamedConstant&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="p">),</span> <span class="n">temp_constant_dict</span><span class="p">)</span>
<span class="n">Constant</span> <span class="o">=</span> <span class="n">NamedConstant</span>
<span class="k">del</span> <span class="n">temp_constant_dict</span>

<span class="c1"># now for a NamedTuple</span>

<span class="k">class</span> <span class="nc">_NamedTupleDict</span><span class="p">(</span><span class="n">OrderedDict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Track field order and ensure field names are not reused.</span>

<span class="sd">    NamedTupleMeta will use the names found in self._field_names to translate</span>
<span class="sd">    to indices.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_field_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_NamedTupleDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Records anything not dundered or not a descriptor.</span>

<span class="sd">        If a field name is used twice, an error is raised.</span>

<span class="sd">        Single underscore (sunder) names are reserved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">_is_sunder</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;_size_&#39;</span><span class="p">,</span> <span class="s1">&#39;_order_&#39;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;_names_ are reserved for future NamedTuple use&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">_is_dunder</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;__order__&#39;</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;_order_&#39;</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_field_names</span><span class="p">:</span>
            <span class="c1"># overwriting a field?</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;attempt to reuse field name: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">))</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">_is_descriptor</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="c1"># field overwriting a descriptor?</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> already defined as: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_field_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_NamedTupleDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_TupleAttributeAtIndex</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">default</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>
        <span class="k">if</span> <span class="n">doc</span> <span class="ow">is</span> <span class="n">undefined</span><span class="p">:</span>
            <span class="n">doc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">doc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">default</span>

    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">owner</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> instance has no value for </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">instance</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%d</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">undefined</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;undefined&#39;</span>
    <span class="k">def</span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="n">__nonzero__</span> <span class="o">=</span> <span class="fm">__bool__</span>
<span class="n">undefined</span> <span class="o">=</span> <span class="n">undefined</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">TupleSize</span><span class="p">(</span><span class="n">NamedConstant</span><span class="p">):</span>
    <span class="n">fixed</span> <span class="o">=</span> <span class="n">constant</span><span class="p">(</span><span class="s1">&#39;fixed&#39;</span><span class="p">,</span> <span class="s1">&#39;tuple length is static&#39;</span><span class="p">)</span>
    <span class="n">minimum</span> <span class="o">=</span> <span class="n">constant</span><span class="p">(</span><span class="s1">&#39;minimum&#39;</span><span class="p">,</span> <span class="s1">&#39;tuple must be at least x long (x is calculated during creation&#39;</span><span class="p">)</span>
    <span class="n">variable</span> <span class="o">=</span> <span class="n">constant</span><span class="p">(</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="s1">&#39;tuple length can be anything&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">NamedTupleMeta</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Metaclass for NamedTuple&quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="fm">__prepare__</span><span class="p">(</span><span class="n">metacls</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">undefined</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_NamedTupleDict</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span> <span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NamedTupleMeta</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">metacls</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">clsdict</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">undefined</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">bases</span> <span class="o">==</span> <span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="p">):</span>
            <span class="n">bases</span> <span class="o">=</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">object</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">tuple</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">object</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">bases</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
                <span class="n">bases</span> <span class="o">=</span> <span class="n">bases</span><span class="p">[:</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="p">)</span> <span class="o">+</span> <span class="n">bases</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bases</span> <span class="o">=</span> <span class="n">bases</span> <span class="o">+</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="p">)</span>
        <span class="c1"># include any fields from base classes</span>
        <span class="n">base_dict</span> <span class="o">=</span> <span class="n">_NamedTupleDict</span><span class="p">()</span>
        <span class="n">namedtuple_bases</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">NamedTupleMeta</span><span class="p">):</span>
                <span class="n">namedtuple_bases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">namedtuple_bases</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">default</span> <span class="ow">in</span> <span class="n">metacls</span><span class="o">.</span><span class="n">_convert_fields</span><span class="p">(</span><span class="o">*</span><span class="n">namedtuple_bases</span><span class="p">):</span>
                <span class="n">base_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">default</span>
                <span class="n">i</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="c1"># construct properly ordered dict with normalized indexes</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">clsdict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">base_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="n">original_dict</span> <span class="o">=</span> <span class="n">base_dict</span>
        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">undefined</span> <span class="ow">and</span> <span class="s1">&#39;_size_&#39;</span> <span class="ow">in</span> <span class="n">original_dict</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;_size_ cannot be set if &quot;size&quot; is passed in header&#39;</span><span class="p">)</span>
        <span class="n">add_order</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">clsdict</span><span class="p">,</span> <span class="n">_NamedTupleDict</span><span class="p">)</span>
        <span class="n">clsdict</span> <span class="o">=</span> <span class="n">_NamedTupleDict</span><span class="p">()</span>
        <span class="n">clsdict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;_size_&#39;</span><span class="p">,</span> <span class="n">size</span> <span class="ow">or</span> <span class="n">TupleSize</span><span class="o">.</span><span class="n">fixed</span><span class="p">)</span>
        <span class="n">unnumbered</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">numbered</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">_order_</span> <span class="o">=</span> <span class="n">original_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_order_&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="n">_order_</span> <span class="p">:</span>
            <span class="n">_order_</span> <span class="o">=</span> <span class="n">_order_</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">add_order</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># and process this class</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">original_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">original_dict</span><span class="o">.</span><span class="n">_field_names</span><span class="p">:</span>
                <span class="n">clsdict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># TODO:normalize v here</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">baseinteger</span><span class="p">):</span>
                    <span class="c1"># assume an offset</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="p">,</span> <span class="n">undefined</span><span class="p">,</span> <span class="n">undefined</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">target</span> <span class="o">=</span> <span class="n">numbered</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                    <span class="c1"># assume a docstring</span>
                    <span class="k">if</span> <span class="n">add_order</span><span class="p">:</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">undefined</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">target</span> <span class="o">=</span> <span class="n">numbered</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="n">undefined</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">undefined</span>
                        <span class="n">target</span> <span class="o">=</span> <span class="n">unnumbered</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">baseinteger</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">basestring</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">)):</span>
                    <span class="c1"># assume an offset, a docstring, and (maybe) a default</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="n">v</span> <span class="o">+</span> <span class="p">(</span><span class="n">undefined</span><span class="p">,</span> <span class="p">)</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">v</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">target</span> <span class="o">=</span> <span class="n">numbered</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">basestring</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">)):</span>
                    <span class="c1"># assume a docstring, and (maybe) a default</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="n">v</span> <span class="o">+</span> <span class="p">(</span><span class="n">undefined</span><span class="p">,</span> <span class="p">)</span>
                    <span class="k">if</span> <span class="n">add_order</span><span class="p">:</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">)</span> <span class="o">+</span> <span class="n">v</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">target</span> <span class="o">=</span> <span class="n">numbered</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">undefined</span><span class="p">,</span> <span class="p">)</span> <span class="o">+</span> <span class="n">v</span>
                        <span class="n">target</span> <span class="o">=</span> <span class="n">unnumbered</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># refuse to guess further</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;not sure what to do with </span><span class="si">%s</span><span class="s1">=</span><span class="si">%r</span><span class="s1"> (should be OFFSET [, DOC [, DEFAULT]])&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
                <span class="n">target</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="c1"># all index values have been normalized</span>
        <span class="c1"># deal with _order_ (or lack thereof)</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">aliases</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">max_len</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_order_</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">unnumbered</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;_order_ not specified and OFFSETs not declared for </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">unnumbered</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="p">))</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">numbered</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">nv</span><span class="p">:</span> <span class="p">(</span><span class="n">nv</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">nv</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                <span class="k">if</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                    <span class="n">aliases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                    <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_len</span><span class="p">,</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">offsets</span> <span class="o">=</span> <span class="n">numbered</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># check if any unnumbered not in _order_</span>
            <span class="n">missing</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">unnumbered</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">_order_</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;unable to order fields: </span><span class="si">%s</span><span class="s2"> (use _order_ or specify OFFSET&quot;</span> <span class="o">%</span> <span class="n">missing</span><span class="p">)</span>
            <span class="n">offsets</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
            <span class="c1"># if any unnumbered, number them from their position in _order_</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">_order_</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">index</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">default</span> <span class="o">=</span> <span class="n">unnumbered</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">numbered</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (from _order_) not found in </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="bp">cls</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">undefined</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="n">index</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                    <span class="n">aliases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                    <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">offsets</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">default</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_len</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="c1"># now handle anything in numbered</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">numbered</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">nv</span><span class="p">:</span> <span class="p">(</span><span class="n">nv</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">nv</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                <span class="k">if</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                    <span class="n">aliases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                    <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                <span class="n">offsets</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">default</span>
                <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_len</span><span class="p">,</span> <span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># at this point fields and aliases should be ordered lists, offsets should be an</span>
        <span class="c1"># OrderedDict with each value an int, str or None or undefined, default or None or undefined</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">aliases</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">offsets</span><span class="p">),</span> <span class="s2">&quot;number of fields + aliases != number of offsets&quot;</span>
        <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">offsets</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">fields</span><span class="p">),</span> <span class="s2">&quot;some fields are not in offsets: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">set</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">offsets</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">aliases</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">offsets</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">aliases</span><span class="p">),</span> <span class="s2">&quot;some aliases are not in offsets: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">set</span><span class="p">(</span><span class="n">aliases</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">offsets</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span> <span class="ow">in</span> <span class="n">offsets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">baseinteger</span><span class="p">),</span> <span class="s2">&quot;index for </span><span class="si">%s</span><span class="s2"> is not an int (</span><span class="si">%s</span><span class="s2">:</span><span class="si">%r</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">index</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="p">(</span><span class="n">basestring</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">))</span> <span class="ow">or</span> <span class="n">doc</span> <span class="ow">is</span> <span class="n">undefined</span><span class="p">,</span> <span class="s2">&quot;doc is not a str, None, nor undefined (</span><span class="si">%s</span><span class="s2">:</span><span class="si">%r</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">doc</span><span class="p">),</span> <span class="n">doc</span><span class="p">)</span>

        <span class="c1"># create descriptors for fields</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span> <span class="ow">in</span> <span class="n">offsets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">clsdict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_TupleAttributeAtIndex</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
        <span class="n">clsdict</span><span class="p">[</span><span class="s1">&#39;__slots__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>

        <span class="c1"># create our new NamedTuple type</span>
        <span class="n">namedtuple_class</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">NamedTupleMeta</span><span class="p">,</span> <span class="n">metacls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">metacls</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">clsdict</span><span class="p">)</span>
        <span class="n">namedtuple_class</span><span class="o">.</span><span class="n">_fields_</span> <span class="o">=</span> <span class="n">fields</span>
        <span class="n">namedtuple_class</span><span class="o">.</span><span class="n">_aliases_</span> <span class="o">=</span> <span class="n">aliases</span>
        <span class="n">namedtuple_class</span><span class="o">.</span><span class="n">_defined_len_</span> <span class="o">=</span> <span class="n">max_len</span>
        <span class="k">return</span> <span class="n">namedtuple_class</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_fields</span><span class="p">(</span><span class="o">*</span><span class="n">namedtuples</span><span class="p">):</span>
        <span class="s2">&quot;create list of index, doc, default triplets for cls in namedtuples&quot;</span>
        <span class="n">all_fields</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">namedtuples</span><span class="p">:</span>
            <span class="n">base</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_fields</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_fields_</span><span class="p">:</span>
                <span class="n">desc</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
                <span class="n">all_fields</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">field</span><span class="p">,</span> <span class="n">base</span><span class="o">+</span><span class="n">desc</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">desc</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">,</span> <span class="n">desc</span><span class="o">.</span><span class="n">default</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">all_fields</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="s2">&quot;A new NamedTuple is created by concatenating the _fields_ and adjusting the descriptors&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">NamedTupleMeta</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">return</span> <span class="n">NamedTupleMeta</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="vm">__name__</span><span class="p">),</span> <span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">other</span><span class="p">),</span> <span class="p">{})</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a new NamedTuple class or an instance of a NamedTuple subclass.</span>

<span class="sd">        NamedTuple should have args of (class_name, names, module)</span>

<span class="sd">            `names` can be:</span>

<span class="sd">                * A string containing member names, separated either with spaces or</span>
<span class="sd">                  commas.  Values are auto-numbered from 1.</span>
<span class="sd">                * An iterable of member names.  Values are auto-numbered from 1.</span>
<span class="sd">                * An iterable of (member name, value) pairs.</span>
<span class="sd">                * A mapping of member name -&gt; value.</span>

<span class="sd">                `module`, if set, will be stored in the new class&#39; __module__ attribute;</span>

<span class="sd">                Note: if `module` is not set this routine will attempt to discover the</span>
<span class="sd">                calling module by walking the frame stack; if this is unsuccessful</span>
<span class="sd">                the resulting class will not be pickleable.</span>

<span class="sd">        subclass should have whatever arguments and/or keywords will be used to create an</span>
<span class="sd">        instance of the subclass</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">cls</span> <span class="ow">is</span> <span class="n">NamedTuple</span><span class="p">:</span>
            <span class="n">original_args</span> <span class="o">=</span> <span class="n">args</span>
            <span class="n">original_kwds</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="c1"># create a new subclass</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;class_name&#39;</span> <span class="ow">in</span> <span class="n">kwds</span><span class="p">:</span>
                    <span class="n">class_name</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;class_name&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">class_name</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">if</span> <span class="s1">&#39;names&#39;</span> <span class="ow">in</span> <span class="n">kwds</span><span class="p">:</span>
                    <span class="n">names</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;names&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">names</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">if</span> <span class="s1">&#39;module&#39;</span> <span class="ow">in</span> <span class="n">kwds</span><span class="p">:</span>
                    <span class="n">module</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;module&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">args</span><span class="p">:</span>
                    <span class="n">module</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">module</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="s1">&#39;type&#39;</span> <span class="ow">in</span> <span class="n">kwds</span><span class="p">:</span>
                    <span class="nb">type</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">args</span><span class="p">:</span>
                    <span class="nb">type</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">type</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;too few arguments to NamedTuple: </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">original_args</span><span class="p">,</span> <span class="n">original_kwds</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">args</span> <span class="ow">or</span> <span class="n">kwds</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;too many arguments to NamedTuple: </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">original_args</span><span class="p">,</span> <span class="n">original_kwds</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">pyver</span> <span class="o">&lt;</span> <span class="mf">3.0</span><span class="p">:</span>
                <span class="c1"># if class_name is unicode, attempt a conversion to ASCII</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">class_name</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">class_name</span> <span class="o">=</span> <span class="n">class_name</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">UnicodeEncodeError</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%r</span><span class="s1"> is not representable in ASCII&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">class_name</span><span class="p">,</span> <span class="p">))</span>
            <span class="c1"># quick exit if names is a NamedTuple</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">NamedTupleMeta</span><span class="p">):</span>
                <span class="n">names</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">class_name</span>
                <span class="k">if</span> <span class="nb">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">names</span><span class="o">.</span><span class="vm">__bases__</span><span class="p">:</span>
                    <span class="n">names</span><span class="o">.</span><span class="vm">__bases__</span> <span class="o">=</span> <span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="p">)</span> <span class="o">+</span> <span class="n">names</span><span class="o">.</span><span class="vm">__bases__</span>
                <span class="k">return</span> <span class="n">names</span>

            <span class="n">metacls</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__class__</span>
            <span class="n">bases</span> <span class="o">=</span> <span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="p">)</span>
            <span class="n">clsdict</span> <span class="o">=</span> <span class="n">metacls</span><span class="o">.</span><span class="fm">__prepare__</span><span class="p">(</span><span class="n">class_name</span><span class="p">,</span> <span class="n">bases</span><span class="p">)</span>

            <span class="c1"># special processing needed for names?</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                <span class="n">names</span> <span class="o">=</span> <span class="n">names</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">basestring</span><span class="p">):</span>
                <span class="n">names</span> <span class="o">=</span> <span class="p">[(</span><span class="n">e</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names</span><span class="p">)]</span>
            <span class="c1"># Here, names is either an iterable of (name, index) or (name, index, doc, default) or a mapping.</span>
            <span class="n">item</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># in case names is empty</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                    <span class="c1"># mapping</span>
                    <span class="n">field_name</span><span class="p">,</span> <span class="n">field_index</span> <span class="o">=</span> <span class="n">item</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># non-mapping</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">field_name</span><span class="p">,</span> <span class="n">field_index</span> <span class="o">=</span> <span class="n">item</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">field_name</span><span class="p">,</span> <span class="n">field_index</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="n">clsdict</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_index</span>
            <span class="k">if</span> <span class="nb">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="nb">type</span> <span class="o">=</span> <span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="p">)</span>
                <span class="n">bases</span> <span class="o">=</span> <span class="nb">type</span> <span class="o">+</span> <span class="n">bases</span>
            <span class="n">namedtuple_class</span> <span class="o">=</span> <span class="n">metacls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">metacls</span><span class="p">,</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">clsdict</span><span class="p">)</span>

            <span class="c1"># TODO: replace the frame hack if a blessed way to know the calling</span>
            <span class="c1"># module is ever developed</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">module</span> <span class="o">=</span> <span class="n">_sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">f_globals</span><span class="p">[</span><span class="s1">&#39;__name__&#39;</span><span class="p">]</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
                    <span class="k">pass</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_make_class_unpicklable</span><span class="p">(</span><span class="n">namedtuple_class</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">namedtuple_class</span><span class="o">.</span><span class="vm">__module__</span> <span class="o">=</span> <span class="n">module</span>

            <span class="k">return</span> <span class="n">namedtuple_class</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># instantiate a subclass</span>
            <span class="n">namedtuple_instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">namedtuple_instance</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
                <span class="n">namedtuple_instance</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">namedtuple_instance</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">__fields__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_fields_</span><span class="p">)</span>
    <span class="c1"># collections.namedtuple compatibility</span>
    <span class="n">_fields</span> <span class="o">=</span> <span class="n">__fields__</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">__aliases__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_aliases_</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;NamedTuple </span><span class="si">%r</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="p">)</span>

<span class="n">temp_namedtuple_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">temp_namedtuple_dict</span><span class="p">[</span><span class="s1">&#39;__doc__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NamedTuple base class.</span><span class="se">\n\n</span><span class="s2">    Derive from this class to define new NamedTuples.</span><span class="se">\n\n</span><span class="s2">&quot;</span>

<span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_size_</span> <span class="ow">is</span> <span class="n">TupleSize</span><span class="o">.</span><span class="n">fixed</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_defined_len_</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> fields expected, </span><span class="si">%d</span><span class="s1"> received&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_defined_len_</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)))</span>
    <span class="n">unknown</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_fields_</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_aliases_</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">unknown</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;unknown fields: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">unknown</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">final_args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">undefined</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">__fields__</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwds</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">index</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>
        <span class="k">if</span> <span class="n">final_args</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">!=</span> <span class="n">undefined</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;field </span><span class="si">%s</span><span class="s1"> specified more than once&#39;</span> <span class="o">%</span> <span class="n">field</span><span class="p">)</span>
        <span class="n">final_args</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">final_args</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">undefined</span><span class="p">:</span>
            <span class="c1"># look for default values</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__fields__</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="n">default</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">default</span>
            <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="n">undefined</span><span class="p">:</span>
                <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">final_args</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">default</span>
    <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_size_</span> <span class="ow">in</span> <span class="p">(</span><span class="n">TupleSize</span><span class="o">.</span><span class="n">fixed</span><span class="p">,</span> <span class="n">TupleSize</span><span class="o">.</span><span class="n">minimum</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;values not provided for field(s): </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing</span><span class="p">))</span>
        <span class="k">while</span> <span class="n">final_args</span> <span class="ow">and</span> <span class="n">final_args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="n">undefined</span><span class="p">:</span>
            <span class="n">final_args</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">missing</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_size_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">TupleSize</span><span class="o">.</span><span class="n">variable</span> <span class="ow">or</span> <span class="n">undefined</span> <span class="ow">in</span> <span class="n">final_args</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;values not provided for field(s): </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">final_args</span><span class="p">))</span>

<span class="n">temp_namedtuple_dict</span><span class="p">[</span><span class="s1">&#39;__new__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="fm">__new__</span>
<span class="k">del</span> <span class="fm">__new__</span>

<span class="k">def</span> <span class="nf">__reduce_ex__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proto</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields_</span><span class="p">)</span>
<span class="n">temp_namedtuple_dict</span><span class="p">[</span><span class="s1">&#39;__reduce_ex__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">__reduce_ex__</span>
<span class="k">del</span> <span class="n">__reduce_ex__</span>

<span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields_</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields_</span><span class="p">,</span> <span class="bp">self</span><span class="p">)])</span>
                <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">repr</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]))</span>
<span class="n">temp_namedtuple_dict</span><span class="p">[</span><span class="s1">&#39;__repr__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="fm">__repr__</span>
<span class="k">del</span> <span class="fm">__repr__</span>

<span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">),</span> <span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields_</span><span class="p">])</span>
            <span class="p">)</span>
<span class="n">temp_namedtuple_dict</span><span class="p">[</span><span class="s1">&#39;__str__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="fm">__str__</span>
<span class="k">del</span> <span class="fm">__str__</span>

<span class="c1">## compatibility methods with stdlib namedtuple</span>
<span class="nd">@property</span>
<span class="k">def</span> <span class="nf">__aliases__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">_aliases_</span><span class="p">)</span>
<span class="n">temp_namedtuple_dict</span><span class="p">[</span><span class="s1">&#39;__aliases__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">__aliases__</span>
<span class="k">del</span> <span class="n">__aliases__</span>

<span class="nd">@property</span>
<span class="k">def</span> <span class="nf">__fields__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">_fields_</span><span class="p">)</span>
<span class="n">temp_namedtuple_dict</span><span class="p">[</span><span class="s1">&#39;__fields__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">__fields__</span>
<span class="n">temp_namedtuple_dict</span><span class="p">[</span><span class="s1">&#39;_fields&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">__fields__</span>
<span class="k">del</span> <span class="n">__fields__</span>

<span class="k">def</span> <span class="nf">_make</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iterable</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">len</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">iterable</span><span class="p">)</span>
<span class="n">temp_namedtuple_dict</span><span class="p">[</span><span class="s1">&#39;_make&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span><span class="n">_make</span><span class="p">)</span>
<span class="k">del</span> <span class="n">_make</span>

<span class="k">def</span> <span class="nf">_asdict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields_</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
<span class="n">temp_namedtuple_dict</span><span class="p">[</span><span class="s1">&#39;_asdict&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_asdict</span>
<span class="k">del</span> <span class="n">_asdict</span>

<span class="k">def</span> <span class="nf">_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
    <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()</span>
    <span class="n">current</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="o">**</span><span class="n">current</span><span class="p">)</span>
<span class="n">temp_namedtuple_dict</span><span class="p">[</span><span class="s1">&#39;_replace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_replace</span>
<span class="k">del</span> <span class="n">_replace</span>

<span class="n">NamedTuple</span> <span class="o">=</span> <span class="n">NamedTupleMeta</span><span class="p">(</span><span class="s1">&#39;NamedTuple&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="p">),</span> <span class="n">temp_namedtuple_dict</span><span class="p">)</span>
<span class="k">del</span> <span class="n">temp_namedtuple_dict</span>

<span class="c1"># defined now for immediate use</span>

<span class="k">def</span> <span class="nf">enumsort</span><span class="p">(</span><span class="n">things</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    sorts things by value if all same type; otherwise by name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">things</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">things</span>
    <span class="n">sort_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">things</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">sort_type</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="c1"># direct sort or type error</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">((</span><span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="n">sort_type</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">things</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;cannot sort items of different types&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">things</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># expecting list of (name, value) tuples</span>
        <span class="n">sort_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">things</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">((</span><span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">is</span> <span class="n">sort_type</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">things</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
                <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">things</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;try name sort instead&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">things</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">export</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    export([collection,] namespace) -&gt; Export members to target namespace.</span>

<span class="sd">    If collection is not given, act as a decorator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">namespace</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">namespace</span> <span class="o">=</span> <span class="n">collection</span>
        <span class="k">def</span> <span class="nf">export_decorator</span><span class="p">(</span><span class="n">collection</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">export</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">export_decorator</span>
    <span class="k">elif</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">NamedConstant</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">collection</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">NamedConstant</span><span class="p">):</span>
                <span class="n">namespace</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>
    <span class="k">elif</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">__members__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">namespace</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%r</span><span class="s1"> is not a supported collection&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">collection</span><span class="p">,)</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">collection</span>

<span class="c1"># Constants used in Enum</span>

<span class="nd">@export</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>
<span class="k">class</span> <span class="nc">EnumConstants</span><span class="p">(</span><span class="n">NamedConstant</span><span class="p">):</span>
    <span class="n">AutoValue</span> <span class="o">=</span> <span class="n">constant</span><span class="p">(</span><span class="s1">&#39;autovalue&#39;</span><span class="p">,</span> <span class="s1">&#39;values are automatically created from _generate_next_value_&#39;</span><span class="p">)</span>
    <span class="n">AutoNumber</span> <span class="o">=</span> <span class="n">constant</span><span class="p">(</span><span class="s1">&#39;autonumber&#39;</span><span class="p">,</span> <span class="s1">&#39;integer value is prepended to members, beginning from START&#39;</span><span class="p">)</span>
    <span class="n">MultiValue</span> <span class="o">=</span> <span class="n">constant</span><span class="p">(</span><span class="s1">&#39;multivalue&#39;</span><span class="p">,</span> <span class="s1">&#39;each member can have several values&#39;</span><span class="p">)</span>
    <span class="n">NoAlias</span> <span class="o">=</span> <span class="n">constant</span><span class="p">(</span><span class="s1">&#39;noalias&#39;</span><span class="p">,</span> <span class="s1">&#39;duplicate valued members are distinct, not aliased&#39;</span><span class="p">)</span>
    <span class="n">Unique</span> <span class="o">=</span> <span class="n">constant</span><span class="p">(</span><span class="s1">&#39;unique&#39;</span><span class="p">,</span> <span class="s1">&#39;duplicate valued members are not allowed&#39;</span><span class="p">)</span>


<span class="c1">############</span>
<span class="c1"># Enum stuff</span>
<span class="c1">############</span>

<span class="c1"># Dummy value for Enum as EnumMeta explicity checks for it, but of course until</span>
<span class="c1"># EnumMeta finishes running the first time the Enum class doesn&#39;t exist.  This</span>
<span class="c1"># is also why there are checks in EnumMeta like `if Enum is not None`</span>
<span class="n">Enum</span> <span class="o">=</span> <span class="n">Flag</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">class</span> <span class="nc">enum</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper class to track args, kwds.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kwds</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_args</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">kwds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kwds</span><span class="p">])</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">args</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwds</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">kwds</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">args</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwds</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">kwds</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">final</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">args</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">final</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="n">kwds</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">=</span><span class="si">%r</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">enumsort</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwds</span><span class="o">.</span><span class="n">items</span><span class="p">()))])</span>
        <span class="k">if</span> <span class="n">kwds</span><span class="p">:</span>
            <span class="n">final</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">final</span><span class="p">))</span>

<span class="n">_auto_null</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">auto</span><span class="p">(</span><span class="n">enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Instances are replaced with an appropriate value in Enum class suites.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_value</span> <span class="o">=</span> <span class="n">_auto_null</span>
    <span class="n">_operations</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">new_auto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">[:]</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">_and_</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">new_auto</span>

    <span class="k">def</span> <span class="fm">__rand__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">new_auto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">[:]</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">_and_</span><span class="p">,</span> <span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">new_auto</span>

    <span class="k">def</span> <span class="fm">__invert__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">new_auto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">[:]</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">_inv_</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,)))</span>
        <span class="k">return</span> <span class="n">new_auto</span>

    <span class="k">def</span> <span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">new_auto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">[:]</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">_or_</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">new_auto</span>

    <span class="k">def</span> <span class="fm">__ror__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">new_auto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">[:]</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">_or_</span><span class="p">,</span> <span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">new_auto</span>

    <span class="k">def</span> <span class="fm">__xor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">new_auto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">[:]</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">_xor_</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">new_auto</span>

    <span class="k">def</span> <span class="fm">__rxor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">new_auto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">[:]</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">_xor_</span><span class="p">,</span> <span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">new_auto</span>

    <span class="k">def</span> <span class="fm">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">new_auto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">[:]</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">_abs_</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">)))</span>
        <span class="k">return</span> <span class="n">new_auto</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">new_auto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">[:]</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">_add_</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">new_auto</span>

    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">new_auto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">[:]</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">_add_</span><span class="p">,</span> <span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">new_auto</span>

    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">new_auto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">[:]</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">_neg_</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">)))</span>
        <span class="k">return</span> <span class="n">new_auto</span>

    <span class="k">def</span> <span class="fm">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">new_auto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">[:]</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">_pos_</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">)))</span>
        <span class="k">return</span> <span class="n">new_auto</span>

    <span class="k">if</span> <span class="n">pyver</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
            <span class="n">new_auto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
            <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">[:]</span>
            <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">_div_</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)))</span>
            <span class="k">return</span> <span class="n">new_auto</span>

    <span class="k">def</span> <span class="nf">__rdiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">new_auto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">[:]</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">_div_</span><span class="p">,</span> <span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">new_auto</span>

    <span class="k">def</span> <span class="fm">__floordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">new_auto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">[:]</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">_floordiv_</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">new_auto</span>

    <span class="k">def</span> <span class="fm">__rfloordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">new_auto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">[:]</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">_floordiv_</span><span class="p">,</span> <span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">new_auto</span>

    <span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">new_auto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">[:]</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">_truediv_</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">new_auto</span>

    <span class="k">def</span> <span class="fm">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">new_auto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">[:]</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">_truediv_</span><span class="p">,</span> <span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">new_auto</span>

    <span class="k">def</span> <span class="fm">__lshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">new_auto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">[:]</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">_lshift_</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">new_auto</span>

    <span class="k">def</span> <span class="fm">__rlshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">new_auto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">[:]</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">_lshift_</span><span class="p">,</span> <span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">new_auto</span>

    <span class="k">def</span> <span class="fm">__rshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">new_auto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">[:]</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">_rshift_</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">new_auto</span>

    <span class="k">def</span> <span class="fm">__rrshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">new_auto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">[:]</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">_rshift_</span><span class="p">,</span> <span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">new_auto</span>

    <span class="k">def</span> <span class="fm">__mod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">new_auto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">[:]</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">_mod_</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">new_auto</span>

    <span class="k">def</span> <span class="fm">__rmod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">new_auto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">[:]</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">_mod_</span><span class="p">,</span> <span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">new_auto</span>

    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">new_auto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">[:]</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">_mul_</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">new_auto</span>

    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">new_auto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">[:]</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">_mul_</span><span class="p">,</span> <span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">new_auto</span>

    <span class="k">def</span> <span class="fm">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">new_auto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">[:]</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">_pow_</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">new_auto</span>

    <span class="k">def</span> <span class="fm">__rpow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">new_auto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">[:]</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">_pow_</span><span class="p">,</span> <span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">new_auto</span>

    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">new_auto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">[:]</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">_sub_</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">new_auto</span>

    <span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">new_auto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">[:]</span>
        <span class="n">new_auto</span><span class="o">.</span><span class="n">_operations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">_sub_</span><span class="p">,</span> <span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">new_auto</span>



    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_auto_null</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;auto() object out of sync&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="ow">is</span> <span class="n">_auto_null</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_auto_null</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve</span><span class="p">()</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_resolve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
            <span class="k">for</span> <span class="n">op</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">:</span>
                <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="n">_auto_null</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">base_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="k">return</span> <span class="n">_auto_null</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base_value</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">op</span><span class="p">(</span><span class="o">*</span><span class="n">values</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_operations</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">return</span> <span class="n">value</span>

<span class="k">class</span> <span class="nc">_EnumDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Track enum member order and ensure member names are not reused.</span>

<span class="sd">    EnumMeta will use the names found in self._member_names as the</span>
<span class="sd">    enumeration member names.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">constructor_init</span><span class="p">,</span> <span class="n">constructor_start</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_EnumDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cls_name</span> <span class="o">=</span> <span class="n">cls_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constructor_init</span> <span class="o">=</span> <span class="n">constructor_init</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constructor_start</span> <span class="o">=</span> <span class="n">constructor_start</span>
        <span class="c1"># for Flag enumerations, we may need to get the _init_ from __new__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_new_to_init</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># list of enum members</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_member_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span> <span class="o">=</span> <span class="n">settings</span>
        <span class="n">autonumber</span> <span class="o">=</span> <span class="n">AutoNumber</span> <span class="ow">in</span> <span class="n">settings</span>
        <span class="n">autovalue</span> <span class="o">=</span> <span class="n">AutoValue</span> <span class="ow">in</span> <span class="n">settings</span>
        <span class="n">multivalue</span> <span class="o">=</span> <span class="n">MultiValue</span> <span class="ow">in</span> <span class="n">settings</span>
        <span class="k">if</span> <span class="n">autonumber</span> <span class="ow">and</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># starting value for AutoNumber</span>
            <span class="n">start</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">autonumber</span><span class="p">:</span>
            <span class="n">autonumber</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">start</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># when the magic turns off</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_locked</span> <span class="o">=</span> <span class="ow">not</span> <span class="p">(</span><span class="n">autovalue</span> <span class="ow">or</span> <span class="n">autonumber</span><span class="p">)</span>
        <span class="c1"># if auto or autonumber</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_autovalue</span> <span class="o">=</span> <span class="n">autovalue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_autonumber</span> <span class="o">=</span> <span class="n">autonumber</span>
        <span class="c1"># if multiple values are allowed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_multivalue</span> <span class="o">=</span> <span class="n">multivalue</span>
        <span class="c1"># if init fields are specified</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># list of temporary names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ignore</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ignore_init_done</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># if _sunder_ values can be changed via the class body</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_allow_init</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_values</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cls_name</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cls_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">enum</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;_auto_on_&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_locked</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autonumber</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_autovalue</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;_auto_off_&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_locked</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_locked</span>
                <span class="ow">or</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span>
                <span class="ow">or</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ignore</span>
                <span class="ow">or</span> <span class="n">_is_sunder</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">_is_dunder</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="p">):</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">_EnumDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autonumber</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># try to generate the next value</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c1"># couldn&#39;t work the magic, report error</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> not found&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autovalue</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_next_value</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_member_names</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_values</span><span class="p">[:])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;neither AutoNumber nor AutoValue set -- why am I here?&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Changes anything not sundured, dundered, nor a descriptor.</span>

<span class="sd">        If an enum member name is used twice, an error is raised; duplicate</span>
<span class="sd">        values are not checked for.</span>

<span class="sd">        Single underscore (sunder) names are reserved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">_is_internal_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cls_name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">_is_sunder</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span>
                    <span class="s1">&#39;_init_&#39;</span><span class="p">,</span> <span class="s1">&#39;_settings_&#39;</span><span class="p">,</span> <span class="s1">&#39;_order_&#39;</span><span class="p">,</span> <span class="s1">&#39;_ignore_&#39;</span><span class="p">,</span> <span class="s1">&#39;_start_&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;_create_pseudo_member_&#39;</span><span class="p">,</span> <span class="s1">&#39;_create_pseudo_member_values_&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;_generate_next_value_&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;_missing_&#39;</span><span class="p">,</span> <span class="s1">&#39;_missing_value_&#39;</span><span class="p">,</span> <span class="s1">&#39;_missing_name_&#39;</span><span class="p">,</span>
                    <span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;_names_ are reserved for  Enum use&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_allow_init</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span>
                    <span class="s1">&#39;create_pseudo_member_&#39;</span><span class="p">,</span> <span class="s1">&#39;_missing_&#39;</span><span class="p">,</span> <span class="s1">&#39;_missing_value_&#39;</span><span class="p">,</span> <span class="s1">&#39;_missing_name_&#39;</span><span class="p">,</span>
                <span class="p">):</span>
                <span class="c1"># sunder is used during creation, must be specified first</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;cannot set </span><span class="si">%r</span><span class="s1"> after init phase&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">))</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;_ignore_&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ignore_init_done</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;ignore can only be specified once&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ignore</span> <span class="o">=</span> <span class="n">value</span>
                <span class="n">already</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_member_names</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">already</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;_ignore_ cannot specify already set names: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">already</span><span class="p">,</span> <span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ignore_init_done</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;_start_&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constructor_start</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;start specified in constructor and class body&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_autonumber</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autovalue</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_locked</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_locked</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_autonumber</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;_settings_&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">set</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">set</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span> <span class="o">|=</span> <span class="n">value</span>
                <span class="k">if</span> <span class="n">NoAlias</span> <span class="ow">in</span> <span class="n">value</span> <span class="ow">and</span> <span class="n">Unique</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;cannot specify both NoAlias and Unique&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">MultiValue</span> <span class="ow">in</span> <span class="n">value</span> <span class="ow">and</span> <span class="n">NoAlias</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;cannot specify both MultiValue and NoAlias&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">AutoValue</span> <span class="ow">in</span> <span class="n">value</span> <span class="ow">and</span> <span class="n">AutoNumber</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;cannot specify both AutoValue and AutoNumber&#39;</span><span class="p">)</span>
                <span class="n">allowed_settings</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">([</span><span class="s1">&#39;autovalue&#39;</span><span class="p">,</span> <span class="s1">&#39;autonumber&#39;</span><span class="p">,</span> <span class="s1">&#39;noalias&#39;</span><span class="p">,</span> <span class="s1">&#39;unique&#39;</span><span class="p">,</span> <span class="s1">&#39;multivalue&#39;</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">arg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_settings</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;unknown qualifier: </span><span class="si">%r</span><span class="s1"> (from </span><span class="si">%r</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
                    <span class="n">allowed_settings</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_multivalue</span> <span class="o">=</span> <span class="n">allowed_settings</span><span class="p">[</span><span class="s1">&#39;multivalue&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_autovalue</span> <span class="o">=</span> <span class="n">allowed_settings</span><span class="p">[</span><span class="s1">&#39;autovalue&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_autonumber</span> <span class="o">=</span> <span class="n">allowed_settings</span><span class="p">[</span><span class="s1">&#39;autonumber&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_locked</span> <span class="o">=</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_autonumber</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autovalue</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_autovalue</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autonumber</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ignore_init_done</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_ignore</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;property&#39;</span><span class="p">,</span> <span class="s1">&#39;classmethod&#39;</span><span class="p">,</span> <span class="s1">&#39;staticmethod&#39;</span><span class="p">,</span> <span class="s1">&#39;aenum&#39;</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autonumber</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autonumber</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;_init_&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constructor_init</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;init specified in constructor and in class body&#39;</span><span class="p">)</span>
                <span class="n">_init_</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_init_</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                    <span class="n">_init_</span> <span class="o">=</span> <span class="n">_init_</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">_init_</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autonumber</span><span class="p">:</span>
                    <span class="n">_init_</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_init</span> <span class="o">=</span> <span class="n">_init_</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;_generate_next_value_&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">staticmethod</span><span class="p">):</span>
                    <span class="n">gnv</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="vm">__func__</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">classmethod</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;_generate_next_value should be a staticmethod, not a classmethod&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">gnv</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_generate_next_value&#39;</span><span class="p">,</span> <span class="n">gnv</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_auto_args</span> <span class="o">=</span> <span class="n">_check_auto_args</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">_is_dunder</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;__order__&#39;</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;_order_&#39;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_allow_init</span><span class="p">:</span>
                    <span class="c1"># _order_ is used during creation, must be specified first</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;cannot set </span><span class="si">%r</span><span class="s1"> after init phase&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">))</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;__new__&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_to_init</span><span class="p">:</span>
                <span class="c1"># ArgSpec(args=[...], varargs=[...], keywords=[...], defaults=[...]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">staticmethod</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="vm">__func__</span>
                <span class="n">new_args</span> <span class="o">=</span> <span class="n">getargspec</span><span class="p">(</span><span class="n">value</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_init</span> <span class="o">=</span> <span class="n">new_args</span>
            <span class="k">if</span> <span class="n">_is_descriptor</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_locked</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_member_names</span><span class="p">:</span>
            <span class="c1"># descriptor overwriting an enum?</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;attempt to reuse name: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">))</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ignore</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">_is_descriptor</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_allow_init</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="c1"># enum overwriting a descriptor?</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> already defined as: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multivalue</span><span class="p">:</span>
                <span class="c1"># make sure it&#39;s a tuple</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">)</span>
                <span class="c1"># do we need to calculate the next value?</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autonumber</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">:</span>
                        <span class="n">target_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span>
                            <span class="n">target_length</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="n">target_length</span><span class="p">:</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">)</span> <span class="o">+</span> <span class="n">value</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">auto</span><span class="p">):</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">)</span> <span class="o">+</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">)</span> <span class="o">+</span> <span class="n">value</span>
                        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                            <span class="k">pass</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autovalue</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">auto</span><span class="p">):</span>
                <span class="c1"># call generate iff init is specified and calls for more values than are present</span>
                <span class="n">target_values</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">)</span>
                <span class="n">source_values</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">target_values</span> <span class="o">!=</span> <span class="n">source_values</span><span class="p">:</span>
                    <span class="n">gnv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_next_value</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auto_args</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">gnv</span><span class="p">(</span>
                                <span class="n">key</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_member_names</span><span class="p">),</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_last_values</span><span class="p">[:],</span>
                                <span class="o">*</span><span class="n">value</span>
                                <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">gnv</span><span class="p">(</span>
                                <span class="n">key</span><span class="p">,</span>
                                <span class="mi">1</span><span class="p">,</span>
                                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_member_names</span><span class="p">),</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_last_values</span><span class="p">[:],</span>
                                <span class="p">)</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autonumber</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_locked</span><span class="p">:</span>
                <span class="c1"># convert any auto instances to integers</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">auto</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">new_value</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">auto</span><span class="p">):</span>
                                <span class="n">new_value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">new_value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">new_value</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                        <span class="c1"># value wasn&#39;t iterable</span>
                        <span class="k">pass</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="c1"># old behavior -&gt; if first item is int, use it as value</span>
                        <span class="c1">#                 otherwise, generate a value and prepend it</span>
                        <span class="k">if</span> <span class="n">value</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">baseinteger</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span> <span class="p">)</span> <span class="o">+</span> <span class="n">value</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">):</span>
                        <span class="c1"># provide actual value for member</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span> <span class="p">)</span> <span class="o">+</span> <span class="n">value</span>
                    <span class="k">elif</span> <span class="s1">&#39;value&#39;</span>  <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="c1"># actual value for member is provided</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="s1">&#39;value&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">count</span><span class="p">,</span> <span class="n">value</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">count</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># mismatch</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: number of fields provided do not match init&#39;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="s1">&#39;value&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: number of fields provided do not match init&#39;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>
                    <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">count</span><span class="p">,</span> <span class="n">value</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">count</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">auto</span><span class="p">):</span>
                <span class="c1"># if AutoNumber set use built-in value, not _generate_next_value_</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autonumber</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">_auto_null</span><span class="p">:</span>
                        <span class="n">gnv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_next_value</span>
                        <span class="n">prev_values</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_values</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">auto</span><span class="p">):</span>
                                <span class="n">prev_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">prev_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gnv</span><span class="p">,</span> <span class="nb">staticmethod</span><span class="p">):</span>
                            <span class="n">gnv</span> <span class="o">=</span> <span class="n">gnv</span><span class="o">.</span><span class="vm">__func__</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auto_args</span><span class="p">:</span>
                            <span class="n">value</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">gnv</span><span class="p">(</span>
                                    <span class="n">key</span><span class="p">,</span>
                                    <span class="mi">1</span><span class="p">,</span>
                                    <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_member_names</span><span class="p">),</span>
                                    <span class="n">prev_values</span><span class="p">,</span>
                                    <span class="o">*</span><span class="n">value</span><span class="o">.</span><span class="n">args</span><span class="p">,</span>
                                    <span class="o">**</span><span class="n">value</span><span class="o">.</span><span class="n">kwds</span>
                                    <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">value</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">gnv</span><span class="p">(</span>
                                    <span class="n">key</span><span class="p">,</span>
                                    <span class="mi">1</span><span class="p">,</span>
                                    <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_member_names</span><span class="p">),</span>
                                    <span class="n">prev_values</span><span class="p">,</span>
                                    <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">enum</span><span class="p">):</span>
                <span class="n">value</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">key</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_member_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># not a new member, turn off the autoassign magic</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_locked</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_allow_init</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_sunder</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_is_dunder</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_is_descriptor</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_autonumber</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multivalue</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_last_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_last_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_EnumDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>


<span class="n">no_arg</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">EnumMeta</span><span class="p">(</span><span class="n">StdlibEnumMeta</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Metaclass for Enum&quot;&quot;&quot;</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="fm">__prepare__</span><span class="p">(</span><span class="n">metacls</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="p">()):</span>
        <span class="c1"># settings are a combination of current and all past settings</span>
        <span class="n">constructor_init</span> <span class="o">=</span> <span class="n">init</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">constructor_start</span> <span class="o">=</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">settings</span> <span class="o">=</span> <span class="n">settings</span><span class="p">,</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
        <span class="n">generate</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">order</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># inherit previous flags</span>
        <span class="n">member_type</span><span class="p">,</span> <span class="n">first_enum</span> <span class="o">=</span> <span class="n">metacls</span><span class="o">.</span><span class="n">_get_mixins_</span><span class="p">(</span><span class="n">bases</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">first_enum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">settings</span> <span class="o">|=</span> <span class="n">first_enum</span><span class="o">.</span><span class="n">_settings_</span>
            <span class="n">init</span> <span class="o">=</span> <span class="n">init</span> <span class="ow">or</span> <span class="n">first_enum</span><span class="o">.</span><span class="n">_auto_init_</span>
            <span class="n">order</span> <span class="o">=</span> <span class="n">first_enum</span><span class="o">.</span><span class="n">_order_function_</span>
            <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">first_enum</span><span class="o">.</span><span class="n">_start_</span>
            <span class="n">generate</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">first_enum</span><span class="p">,</span> <span class="s1">&#39;_generate_next_value_&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">generate</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">generate</span><span class="p">,</span> <span class="s1">&#39;im_func&#39;</span><span class="p">,</span> <span class="n">generate</span><span class="p">)</span>
        <span class="c1"># check for custom settings</span>
        <span class="k">if</span> <span class="n">NoAlias</span> <span class="ow">in</span> <span class="n">settings</span> <span class="ow">and</span> <span class="n">Unique</span> <span class="ow">in</span> <span class="n">settings</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;cannot specify both NoAlias and Unique&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">MultiValue</span> <span class="ow">in</span> <span class="n">settings</span> <span class="ow">and</span> <span class="n">NoAlias</span> <span class="ow">in</span> <span class="n">settings</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;cannot specify both MultiValue and NoAlias&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">AutoValue</span> <span class="ow">in</span> <span class="n">settings</span> <span class="ow">and</span> <span class="n">AutoNumber</span> <span class="ow">in</span> <span class="n">settings</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;cannot specify both AutoValue and AutoNumber&#39;</span><span class="p">)</span>
        <span class="n">allowed_settings</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">([</span><span class="s1">&#39;autovalue&#39;</span><span class="p">,</span> <span class="s1">&#39;autonumber&#39;</span><span class="p">,</span> <span class="s1">&#39;noalias&#39;</span><span class="p">,</span> <span class="s1">&#39;unique&#39;</span><span class="p">,</span> <span class="s1">&#39;multivalue&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">settings</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">arg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_settings</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;unknown qualifier: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="p">))</span>
            <span class="n">allowed_settings</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">enum_dict</span> <span class="o">=</span> <span class="n">_EnumDict</span><span class="p">(</span><span class="n">cls_name</span><span class="o">=</span><span class="bp">cls</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">constructor_init</span><span class="o">=</span><span class="n">constructor_init</span><span class="p">,</span> <span class="n">constructor_start</span><span class="o">=</span><span class="n">constructor_start</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">settings</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">([</span><span class="n">AutoValue</span><span class="p">,</span> <span class="n">AutoNumber</span><span class="p">])</span> <span class="ow">or</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">enum_dict</span><span class="p">[</span><span class="s1">&#39;_ignore_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;property&#39;</span><span class="p">,</span> <span class="s1">&#39;classmethod&#39;</span><span class="p">,</span> <span class="s1">&#39;staticmethod&#39;</span><span class="p">]</span>
            <span class="n">enum_dict</span><span class="o">.</span><span class="n">_ignore_init_done</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">generate</span><span class="p">:</span>
            <span class="n">enum_dict</span><span class="p">[</span><span class="s1">&#39;_generate_next_value_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">generate</span>
        <span class="k">if</span> <span class="n">init</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">init</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                <span class="n">init</span> <span class="o">=</span> <span class="n">init</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">init</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">AutoNumber</span> <span class="ow">in</span> <span class="n">settings</span><span class="p">:</span>
                <span class="n">init</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">enum_dict</span><span class="o">.</span><span class="n">_init</span> <span class="o">=</span> <span class="n">init</span>
        <span class="k">elif</span> <span class="n">Flag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="nb">issubclass</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">Flag</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">)</span> <span class="ow">and</span> <span class="n">member_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">object</span><span class="p">):</span>
            <span class="n">enum_dict</span><span class="o">.</span><span class="n">_new_to_init</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">Flag</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">:</span>
                <span class="c1"># only happens on first mixin with Flag</span>
                <span class="k">def</span> <span class="nf">_generate_next_value_</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
                    <span class="k">return</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">count</span><span class="p">,</span> <span class="p">)</span> <span class="o">+</span> <span class="n">args</span>
                <span class="n">enum_dict</span><span class="p">[</span><span class="s1">&#39;_generate_next_value_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">_generate_next_value_</span><span class="p">)</span>
                <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">flag_value</span><span class="p">,</span> <span class="n">type_value</span><span class="p">):</span>
                    <span class="n">obj</span> <span class="o">=</span> <span class="n">member_type</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">type_value</span><span class="p">)</span>
                    <span class="n">obj</span><span class="o">.</span><span class="n">_value_</span> <span class="o">=</span> <span class="n">flag_value</span>
                    <span class="k">return</span> <span class="n">obj</span>
                <span class="n">enum_dict</span><span class="p">[</span><span class="s1">&#39;__new__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="fm">__new__</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">new_args</span> <span class="o">=</span> <span class="n">getargspec</span><span class="p">(</span><span class="n">first_enum</span><span class="o">.</span><span class="n">__new_member__</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="n">enum_dict</span><span class="o">.</span><span class="n">_init</span> <span class="o">=</span> <span class="n">new_args</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="k">pass</span>
        <span class="k">if</span> <span class="n">order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">enum_dict</span><span class="p">[</span><span class="s1">&#39;_order_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">enum_dict</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span> <span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">EnumMeta</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">metacls</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">clsdict</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="p">()):</span>
        <span class="c1"># handle py2 case first</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">clsdict</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_EnumDict</span><span class="p">:</span>
            <span class="c1"># py2 ard/or functional API gyrations</span>
            <span class="n">init</span> <span class="o">=</span> <span class="n">clsdict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_init_&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">clsdict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_start_&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">settings</span> <span class="o">=</span> <span class="n">clsdict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_settings_&#39;</span><span class="p">,</span> <span class="p">())</span>
            <span class="n">_order_</span> <span class="o">=</span> <span class="n">clsdict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_order_&#39;</span><span class="p">,</span> <span class="n">clsdict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;__order__&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">_ignore_</span> <span class="o">=</span> <span class="n">clsdict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_ignore_&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">_create_pseudo_member_</span> <span class="o">=</span> <span class="n">clsdict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_create_pseudo_member_&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">_create_pseudo_member_values_</span> <span class="o">=</span> <span class="n">clsdict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_create_pseudo_member_values_&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">_generate_next_value_</span> <span class="o">=</span> <span class="n">clsdict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_generate_next_value_&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">_missing_</span> <span class="o">=</span> <span class="n">clsdict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_missing_&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">_missing_value_</span> <span class="o">=</span> <span class="n">clsdict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_missing_value_&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">_missing_name_</span> <span class="o">=</span> <span class="n">clsdict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_missing_name_&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="fm">__new__</span> <span class="o">=</span> <span class="n">clsdict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;__new__&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">enum_members</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([</span>
                    <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">clsdict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">_is_sunder</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">or</span> <span class="n">_is_dunder</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">or</span> <span class="n">_is_descriptor</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
                    <span class="p">])</span>
            <span class="n">original_dict</span> <span class="o">=</span> <span class="n">clsdict</span>
            <span class="n">clsdict</span> <span class="o">=</span> <span class="n">metacls</span><span class="o">.</span><span class="fm">__prepare__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="n">init</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">)</span>
            <span class="n">init</span> <span class="o">=</span> <span class="n">init</span> <span class="ow">or</span> <span class="n">clsdict</span><span class="o">.</span><span class="n">_init</span>
            <span class="k">if</span> <span class="n">_order_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_order_</span> <span class="o">=</span> <span class="n">clsdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_order_&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">_order_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">_order_</span> <span class="o">=</span> <span class="n">_order_</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">original_dict</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">):</span>
                <span class="n">calced_order</span> <span class="o">=</span> <span class="n">original_dict</span>
            <span class="k">elif</span> <span class="n">_order_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">calced_order</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">enumsort</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">enum_members</span><span class="o">.</span><span class="n">items</span><span class="p">()))]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_order_</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                <span class="n">calced_order</span> <span class="o">=</span> <span class="n">_order_</span> <span class="o">=</span> <span class="n">_order_</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">_order_</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">init</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">init</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                        <span class="n">init</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>
                <span class="n">member</span> <span class="o">=</span> <span class="n">NamedTuple</span><span class="p">(</span><span class="s1">&#39;member&#39;</span><span class="p">,</span> <span class="n">init</span> <span class="ow">and</span> <span class="s1">&#39;name &#39;</span> <span class="o">+</span> <span class="n">init</span> <span class="ow">or</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">])</span>
                <span class="n">calced_order</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">enum_members</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">init</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">)</span>
                        <span class="n">name_value</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">)</span> <span class="o">+</span> <span class="n">value</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">name_value</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">member</span><span class="o">.</span><span class="n">_defined_len_</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_value</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> values expected (</span><span class="si">%s</span><span class="s1">), </span><span class="si">%d</span><span class="s1"> received (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="n">member</span><span class="o">.</span><span class="n">_defined_len_</span><span class="p">,</span>
                            <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">member</span><span class="o">.</span><span class="n">_fields_</span><span class="p">),</span>
                            <span class="nb">len</span><span class="p">(</span><span class="n">name_value</span><span class="p">),</span>
                            <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">repr</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">name_value</span><span class="p">]),</span>
                            <span class="p">))</span>
                    <span class="n">calced_order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">member</span><span class="p">(</span><span class="o">*</span><span class="n">name_value</span><span class="p">))</span>
                <span class="n">calced_order</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">calced_order</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">_order_</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">calced_order</span> <span class="o">=</span> <span class="n">_order_</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">(</span>
                    <span class="s1">&#39;_ignore_&#39;</span><span class="p">,</span> <span class="s1">&#39;_create_pseudo_member_&#39;</span><span class="p">,</span> <span class="s1">&#39;_create_pseudo_member_values_&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;_generate_next_value_&#39;</span><span class="p">,</span> <span class="s1">&#39;_order_&#39;</span><span class="p">,</span> <span class="s1">&#39;__new__&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;_missing_&#39;</span><span class="p">,</span> <span class="s1">&#39;_missing_value_&#39;</span><span class="p">,</span> <span class="s1">&#39;_missing_name_&#39;</span><span class="p">,</span>
                <span class="p">):</span>
                <span class="n">attr</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()[</span><span class="n">name</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">attr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">clsdict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">attr</span>
            <span class="c1"># now add members</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">calced_order</span><span class="p">:</span>
                <span class="n">clsdict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">original_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">original_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">calced_order</span><span class="p">:</span>
                    <span class="n">clsdict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">del</span> <span class="n">_order_</span><span class="p">,</span> <span class="n">_ignore_</span><span class="p">,</span> <span class="n">_create_pseudo_member_</span><span class="p">,</span> <span class="n">_create_pseudo_member_values_</span><span class="p">,</span>
            <span class="k">del</span> <span class="n">_generate_next_value_</span><span class="p">,</span> <span class="n">_missing_</span><span class="p">,</span> <span class="n">_missing_value_</span><span class="p">,</span> <span class="n">_missing_name_</span>

        <span class="c1"># resume normal path</span>
        <span class="k">if</span> <span class="n">clsdict</span><span class="o">.</span><span class="n">_new_to_init</span><span class="p">:</span>
            <span class="c1"># remove calculated _init_ as it&#39;s no longer needed</span>
            <span class="n">clsdict</span><span class="o">.</span><span class="n">_init</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">clsdict</span><span class="o">.</span><span class="n">_locked</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">member_type</span><span class="p">,</span> <span class="n">first_enum</span> <span class="o">=</span> <span class="n">metacls</span><span class="o">.</span><span class="n">_get_mixins_</span><span class="p">(</span><span class="n">bases</span><span class="p">)</span>
        <span class="n">_order_</span> <span class="o">=</span> <span class="n">clsdict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_order_&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_order_</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">_order_</span> <span class="o">=</span> <span class="n">_order_</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">init</span> <span class="o">=</span> <span class="n">clsdict</span><span class="o">.</span><span class="n">_init</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">clsdict</span><span class="o">.</span><span class="n">_value</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="n">clsdict</span><span class="o">.</span><span class="n">_settings</span>
        <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">creating_init</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">auto_init</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">init</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">AutoNumber</span> <span class="ow">in</span> <span class="n">settings</span> <span class="ow">or</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">creating_init</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">init</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">auto_init</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">AutoNumber</span> <span class="ow">in</span> <span class="n">settings</span> <span class="ow">or</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;value&#39;</span> <span class="ow">not</span> <span class="ow">in</span>  <span class="n">init</span><span class="p">:</span>
                <span class="n">creating_init</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">init</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">creating_init</span> <span class="o">=</span> <span class="n">init</span><span class="p">[:]</span>
        <span class="n">autonumber</span> <span class="o">=</span> <span class="n">AutoNumber</span> <span class="ow">in</span> <span class="n">settings</span>
        <span class="n">autovalue</span> <span class="o">=</span> <span class="n">AutoValue</span> <span class="ow">in</span> <span class="n">settings</span>
        <span class="n">multivalue</span> <span class="o">=</span> <span class="n">MultiValue</span> <span class="ow">in</span> <span class="n">settings</span>
        <span class="n">noalias</span> <span class="o">=</span> <span class="n">NoAlias</span> <span class="ow">in</span> <span class="n">settings</span>
        <span class="n">unique</span> <span class="o">=</span> <span class="n">Unique</span> <span class="ow">in</span> <span class="n">settings</span>
        <span class="c1"># an Enum class cannot be mixed with other types (int, float, etc.) if</span>
        <span class="c1">#   it has an inherited __new__ unless a new __new__ is defined (or</span>
        <span class="c1">#   the resulting class will fail).</span>
        <span class="c1"># an Enum class is final once enumeration items have been defined;</span>
        <span class="c1">#</span>
        <span class="c1"># remove any keys listed in _ignore_</span>
        <span class="n">clsdict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;_ignore_&#39;</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;_ignore_&#39;</span><span class="p">)</span>
        <span class="n">ignore</span> <span class="o">=</span> <span class="n">clsdict</span><span class="p">[</span><span class="s1">&#39;_ignore_&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ignore</span><span class="p">:</span>
            <span class="n">clsdict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="c1"># get the method to create enum members</span>
        <span class="fm">__new__</span><span class="p">,</span> <span class="n">save_new</span><span class="p">,</span> <span class="n">new_uses_args</span> <span class="o">=</span> <span class="n">metacls</span><span class="o">.</span><span class="n">_find_new_</span><span class="p">(</span>
                <span class="n">clsdict</span><span class="p">,</span>
                <span class="n">member_type</span><span class="p">,</span>
                <span class="n">first_enum</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="c1"># save enum items into separate mapping so they don&#39;t get baked into</span>
        <span class="c1"># the new class</span>
        <span class="n">enum_members</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">clsdict</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">clsdict</span><span class="o">.</span><span class="n">_member_names</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">clsdict</span><span class="o">.</span><span class="n">_member_names</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">clsdict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="c1"># move skipped values out of the descriptor, and add names to DynamicAttributes</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">clsdict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">nonmember</span><span class="p">):</span>
                <span class="nb">dict</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">clsdict</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">enum_property</span><span class="p">):</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="c1"># check for illegal enum names (any others?)</span>
        <span class="n">invalid_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">enum_members</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;mro&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">invalid_names</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid enum member name(s): </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">invalid_names</span><span class="p">),</span> <span class="p">))</span>
        <span class="c1"># create our new Enum type</span>
        <span class="n">enum_class</span> <span class="o">=</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">metacls</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">clsdict</span><span class="p">)</span>
        <span class="n">enum_class</span><span class="o">.</span><span class="n">_member_names_</span> <span class="o">=</span> <span class="p">[]</span>               <span class="c1"># names in random order</span>
        <span class="n">enum_class</span><span class="o">.</span><span class="n">_member_map_</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">enum_class</span><span class="o">.</span><span class="n">_member_type_</span> <span class="o">=</span> <span class="n">member_type</span>
        <span class="c1"># save current flags for subclasses</span>
        <span class="n">enum_class</span><span class="o">.</span><span class="n">_settings_</span> <span class="o">=</span> <span class="n">settings</span>
        <span class="n">enum_class</span><span class="o">.</span><span class="n">_start_</span> <span class="o">=</span> <span class="n">start</span>
        <span class="n">enum_class</span><span class="o">.</span><span class="n">_auto_init_</span> <span class="o">=</span> <span class="n">_auto_init_</span> <span class="o">=</span> <span class="n">init</span>
        <span class="n">enum_class</span><span class="o">.</span><span class="n">_order_function_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;value&#39;</span> <span class="ow">in</span> <span class="n">creating_init</span> <span class="ow">and</span> <span class="n">creating_init</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;value&#39;, if specified, must be the first item in &#39;init&#39;&quot;</span><span class="p">)</span>
        <span class="c1"># save attributes from super classes so we know if we can take</span>
        <span class="c1"># the shortcut of storing members in the class dict</span>
        <span class="n">base_attributes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">enum_class</span><span class="o">.</span><span class="n">mro</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">b</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">])</span>
        <span class="c1"># Reverse value-&gt;name map for hashable values.</span>
        <span class="n">enum_class</span><span class="o">.</span><span class="n">_value2member_map_</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">enum_class</span><span class="o">.</span><span class="n">_value2member_seq_</span> <span class="o">=</span> <span class="p">()</span>
        <span class="c1"># instantiate them, checking for duplicates as we go</span>
        <span class="c1"># we instantiate first instead of checking for duplicates first in case</span>
        <span class="c1"># a custom __new__ is doing something funky with the values -- such as</span>
        <span class="c1"># auto-numbering ;)</span>
        <span class="k">if</span> <span class="fm">__new__</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="fm">__new__</span> <span class="o">=</span> <span class="n">enum_class</span><span class="o">.</span><span class="fm">__new__</span>
        <span class="k">for</span> <span class="n">member_name</span> <span class="ow">in</span> <span class="n">clsdict</span><span class="o">.</span><span class="n">_member_names</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">enum_members</span><span class="p">[</span><span class="n">member_name</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">auto</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">value</span>
            <span class="n">kwds</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">new_args</span> <span class="o">=</span> <span class="p">()</span>
            <span class="n">init_args</span> <span class="o">=</span> <span class="p">()</span>
            <span class="n">extra_mv_args</span> <span class="o">=</span> <span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">enum</span><span class="p">):</span>
                <span class="n">args</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">args</span>
                <span class="n">kwds</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">kwds</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Member</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">value</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">args</span> <span class="o">=</span> <span class="n">value</span>
            <span class="c1"># possibilities</span>
            <span class="c1">#</span>
            <span class="c1"># - no init, multivalue  -&gt; __new__[0], __init__(*[:]), extra=[1:]</span>
            <span class="c1"># - init w/o value, multivalue  -&gt; __new__[0], __init__(*[:]), extra=[1:]</span>
            <span class="c1">#</span>
            <span class="c1"># - init w/value, multivalue  -&gt; __new__[0], __init__(*[1:]),  extra=[1:]</span>
            <span class="c1">#</span>
            <span class="c1"># - init w/value, no multivalue  -&gt; __new__[0], __init__(*[1:]), extra=[]</span>
            <span class="c1">#</span>
            <span class="c1"># - init w/o value, no multivalue  -&gt; __new__[:], __init__(*[:]), extra=[]</span>
            <span class="c1"># - no init, no multivalue  -&gt;  __new__[:], __init__(*[:]), extra=[]</span>
            <span class="k">if</span> <span class="n">multivalue</span> <span class="ow">or</span> <span class="s1">&#39;value&#39;</span> <span class="ow">in</span> <span class="n">creating_init</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">multivalue</span><span class="p">:</span>
                    <span class="c1"># when multivalue is True, creating_init can be anything</span>
                    <span class="n">new_args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">extra_mv_args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="k">if</span> <span class="s1">&#39;value&#39;</span> <span class="ow">in</span> <span class="n">creating_init</span><span class="p">:</span>
                        <span class="n">init_args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">init_args</span> <span class="o">=</span> <span class="n">args</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># &#39;value&#39; is definitely in creating_init</span>
                    <span class="n">new_args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">auto_init</span><span class="p">:</span>
                        <span class="c1"># don&#39;t pass in value</span>
                        <span class="n">init_args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># keep the all args for user-defined __init__</span>
                        <span class="n">init_args</span> <span class="o">=</span> <span class="n">args</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">new_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># either no creating_init, or it doesn&#39;t have &#39;value&#39;</span>
                <span class="n">new_args</span> <span class="o">=</span> <span class="n">args</span>
                <span class="n">init_args</span> <span class="o">=</span> <span class="n">args</span>
            <span class="k">if</span> <span class="n">member_type</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>   <span class="c1"># special case for tuple enums</span>
                <span class="n">new_args</span> <span class="o">=</span> <span class="p">(</span><span class="n">new_args</span><span class="p">,</span> <span class="p">)</span>     <span class="c1"># wrap it one more time</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">new_uses_args</span><span class="p">:</span>
                <span class="n">enum_member</span> <span class="o">=</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">enum_class</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">enum_member</span><span class="p">,</span> <span class="s1">&#39;_value_&#39;</span><span class="p">):</span>
                    <span class="n">enum_member</span><span class="o">.</span><span class="n">_value_</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">enum_member</span> <span class="o">=</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">enum_class</span><span class="p">,</span> <span class="o">*</span><span class="n">new_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">enum_member</span><span class="p">,</span> <span class="s1">&#39;_value_&#39;</span><span class="p">):</span>
                    <span class="n">enum_member</span><span class="o">.</span><span class="n">_value_</span> <span class="o">=</span> <span class="n">member_type</span><span class="p">(</span><span class="o">*</span><span class="n">new_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">enum_member</span><span class="o">.</span><span class="n">_value_</span>
            <span class="n">enum_member</span><span class="o">.</span><span class="n">_name_</span> <span class="o">=</span> <span class="n">member_name</span>
            <span class="n">enum_member</span><span class="o">.</span><span class="vm">__objclass__</span> <span class="o">=</span> <span class="n">enum_class</span>
            <span class="n">enum_member</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">init_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
            <span class="c1"># If another member with the same value was already defined, the</span>
            <span class="c1"># new member becomes an alias to the existing one.</span>
            <span class="k">if</span> <span class="n">noalias</span><span class="p">:</span>
                <span class="c1"># unless NoAlias was specified</span>
                <span class="n">enum_class</span><span class="o">.</span><span class="n">_member_names_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">member_name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nonunique</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">canonical_member</span> <span class="ow">in</span> <span class="n">enum_class</span><span class="o">.</span><span class="n">_member_map_</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">canonical_member</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">enum_member</span><span class="o">.</span><span class="n">_value_</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">unique</span><span class="p">:</span>
                            <span class="n">nonunique</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">member_name</span><span class="p">)</span>
                            <span class="k">continue</span>
                        <span class="n">enum_member</span> <span class="o">=</span> <span class="n">canonical_member</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Aliases don&#39;t appear in member names (only in __members__).</span>
                    <span class="n">enum_class</span><span class="o">.</span><span class="n">_member_names_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">member_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">nonunique</span><span class="p">:</span>
                    <span class="c1"># duplicates not allowed if Unique specified</span>
                    <span class="n">message</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">aliases</span> <span class="ow">in</span> <span class="n">nonunique</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">bad_aliases</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">aliases</span><span class="p">)</span>
                        <span class="n">message</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> --&gt; </span><span class="si">%s</span><span class="s1"> [</span><span class="si">%r</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">bad_aliases</span><span class="p">,</span> <span class="n">enum_class</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="s1">&#39;duplicate names found in </span><span class="si">%r</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                                <span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;;  &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>
                            <span class="p">)</span>
            <span class="c1"># members are added as enum_property&#39;s</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">enum_class</span><span class="p">,</span> <span class="n">member_name</span><span class="p">,</span> <span class="n">enum_property</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">member_name</span><span class="p">))</span>
            <span class="c1"># now add to _member_map_</span>
            <span class="n">enum_class</span><span class="o">.</span><span class="n">_member_map_</span><span class="p">[</span><span class="n">member_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">enum_member</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">)</span> <span class="o">+</span> <span class="n">extra_mv_args</span>
            <span class="n">enum_member</span><span class="o">.</span><span class="n">_values_</span> <span class="o">=</span> <span class="n">values</span>
            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                <span class="c1"># first check if value has already been used</span>
                <span class="k">if</span> <span class="n">multivalue</span> <span class="ow">and</span> <span class="p">(</span>
                        <span class="n">value</span> <span class="ow">in</span> <span class="n">enum_class</span><span class="o">.</span><span class="n">_value2member_map_</span>
                        <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="n">v</span> <span class="o">==</span> <span class="n">value</span> <span class="k">for</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="ow">in</span> <span class="n">enum_class</span><span class="o">.</span><span class="n">_value2member_seq_</span><span class="p">)</span>
                        <span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%r</span><span class="s1"> has already been used&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">))</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># This may fail if value is not hashable. We can&#39;t add the value</span>
                    <span class="c1"># to the map, and by-value lookups for this value will be</span>
                    <span class="c1"># linear.</span>
                    <span class="k">if</span> <span class="n">noalias</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;cannot use dict to store value&#39;</span><span class="p">)</span>
                    <span class="n">enum_class</span><span class="o">.</span><span class="n">_value2member_map_</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="n">enum_member</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="n">enum_class</span><span class="o">.</span><span class="n">_value2member_seq_</span> <span class="o">+=</span> <span class="p">((</span><span class="n">value</span><span class="p">,</span> <span class="n">enum_member</span><span class="p">),</span> <span class="p">)</span>
        <span class="c1"># check for constants with auto() values</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">enum_class</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">constant</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">auto</span><span class="p">):</span>
                <span class="n">v</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">enum_class</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="c1"># If a custom type is mixed into the Enum, and it does not know how</span>
        <span class="c1"># to pickle itself, pickle.dumps will succeed but pickle.loads will</span>
        <span class="c1"># fail.  Rather than have the error show up later and possibly far</span>
        <span class="c1"># from the source, sabotage the pickle protocol for this class so</span>
        <span class="c1"># that pickle.dumps also fails.</span>
        <span class="c1">#</span>
        <span class="c1"># However, if the new class implements its own __reduce_ex__, do not</span>
        <span class="c1"># sabotage -- it&#39;s on them to make sure it works correctly.  We use</span>
        <span class="c1"># __reduce_ex__ instead of any of the others as it is preferred by</span>
        <span class="c1"># pickle over __reduce__, and it handles all pickle protocols.</span>
        <span class="n">unpicklable</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s1">&#39;__reduce_ex__&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">clsdict</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">member_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">object</span><span class="p">:</span>
                <span class="n">methods</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;__getnewargs_ex__&#39;</span><span class="p">,</span> <span class="s1">&#39;__getnewargs__&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;__reduce_ex__&#39;</span><span class="p">,</span> <span class="s1">&#39;__reduce__&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">m</span> <span class="ow">in</span> <span class="n">member_type</span><span class="o">.</span><span class="vm">__dict__</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">):</span>
                    <span class="n">_make_class_unpicklable</span><span class="p">(</span><span class="n">enum_class</span><span class="p">)</span>
                    <span class="n">unpicklable</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># double check that repr and friends are not the mixin&#39;s or various</span>
        <span class="c1"># things break (such as pickle)</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;__repr__&#39;</span><span class="p">,</span> <span class="s1">&#39;__str__&#39;</span><span class="p">,</span> <span class="s1">&#39;__format__&#39;</span><span class="p">,</span> <span class="s1">&#39;__reduce_ex__&#39;</span><span class="p">):</span>
            <span class="n">enum_class_method</span> <span class="o">=</span> <span class="n">enum_class</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">enum_class_method</span><span class="p">:</span>
                <span class="c1"># class has defined/imported/copied the method</span>
                <span class="k">continue</span>
            <span class="n">class_method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">enum_class</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">obj_method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">member_type</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">enum_method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">first_enum</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">obj_method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">obj_method</span> <span class="o">==</span> <span class="n">class_method</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;__reduce_ex__&#39;</span> <span class="ow">and</span> <span class="n">unpicklable</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">enum_class</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">enum_method</span><span class="p">)</span>

        <span class="c1"># method resolution and int&#39;s are not playing nice</span>
        <span class="c1"># Python&#39;s less than 2.6 use __cmp__</span>

        <span class="k">if</span> <span class="n">pyver</span> <span class="o">&lt;</span> <span class="mf">2.6</span><span class="p">:</span>

            <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">enum_class</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">enum_class</span><span class="p">,</span> <span class="s1">&#39;__cmp__&#39;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="s1">&#39;__cmp__&#39;</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">pyver</span> <span class="o">&lt;</span> <span class="mf">3.0</span><span class="p">:</span>

            <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">enum_class</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">(</span>
                        <span class="s1">&#39;__le__&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;__lt__&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;__gt__&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;__ge__&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;__eq__&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;__ne__&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;__hash__&#39;</span><span class="p">,</span>
                        <span class="p">):</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">enum_class</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">method</span><span class="p">))</span>

        <span class="c1"># replace any other __new__ with our own (as long as Enum is not None,</span>
        <span class="c1"># anyway) -- again, this is to support pickle</span>
        <span class="k">if</span> <span class="n">Enum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># if the user defined their own __new__, save it before it gets</span>
            <span class="c1"># clobbered in case they subclass later</span>
            <span class="k">if</span> <span class="n">save_new</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">enum_class</span><span class="p">,</span> <span class="s1">&#39;__new_member__&#39;</span><span class="p">,</span> <span class="n">enum_class</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;__new__&#39;</span><span class="p">])</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">enum_class</span><span class="p">,</span> <span class="s1">&#39;__new__&#39;</span><span class="p">,</span> <span class="n">Enum</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;__new__&#39;</span><span class="p">])</span>

        <span class="c1"># py3 support for definition order (helps keep py2/py3 code in sync)</span>
        <span class="k">if</span> <span class="n">_order_</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_order_</span><span class="p">,</span> <span class="nb">staticmethod</span><span class="p">):</span>
                <span class="c1"># _order_ = staticmethod.__get__(enum_class)</span>
                <span class="c1"># _order_ = getattr(_order_, &#39;im_func&#39;, _order_)</span>
                <span class="n">_order_</span> <span class="o">=</span> <span class="n">_order_</span><span class="o">.</span><span class="vm">__func__</span>
            <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">_order_</span><span class="p">):</span>
                <span class="c1"># save order for future subclasses</span>
                <span class="n">enum_class</span><span class="o">.</span><span class="n">_order_function_</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">_order_</span><span class="p">)</span>
                <span class="c1"># create ordered list for comparison</span>
                <span class="n">_order_</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">enum_class</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">_order_</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">_order_</span> <span class="o">!=</span> <span class="n">enum_class</span><span class="o">.</span><span class="n">_member_names_</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;member order does not match _order_: </span><span class="si">%r</span><span class="s1"> </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">enum_class</span><span class="o">.</span><span class="n">_member_names_</span><span class="p">,</span> <span class="n">enum_class</span><span class="o">.</span><span class="n">_member_map_</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
        <span class="k">return</span> <span class="n">enum_class</span>

    <span class="k">def</span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        classes/types should always be True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">no_arg</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Either returns an existing member, or creates a new enum class.</span>

<span class="sd">        This method is used both when an enum class is given a value to match</span>
<span class="sd">        to an enumeration member (i.e. Color(3)) and for the functional API</span>
<span class="sd">        (i.e. Color = Enum(&#39;Color&#39;, names=&#39;red green blue&#39;)).</span>

<span class="sd">        When used for the functional API: `module`, if set, will be stored in</span>
<span class="sd">        the new class&#39; __module__ attribute; `type`, if set, will be mixed in</span>
<span class="sd">        as the first base class.</span>

<span class="sd">        Note: if `module` is not set this routine will attempt to discover the</span>
<span class="sd">        calling module by walking the frame stack; if this is unsuccessful</span>
<span class="sd">        the resulting class will not be pickleable.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># simple value lookup</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="c1"># otherwise, functional API: we&#39;re creating a new Enum type</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_create_</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="n">module</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">member</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">member</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%r</span><span class="s2"> (</span><span class="si">%r</span><span class="s2">) is not an &lt;aenum &#39;Enum&#39;&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">member</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">member</span><span class="p">)))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">member</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__delattr__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="c1"># nicer error message when someone tries to delete an attribute</span>
        <span class="c1"># (see issue19025).</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_member_map_</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: cannot delete Enum member </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">attr</span><span class="p">),</span>
                    <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_get_attr_from_chain</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">attr</span><span class="p">),</span> <span class="n">constant</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: cannot delete constant </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">attr</span><span class="p">),</span>
                    <span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">EnumMeta</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__delattr__</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">([</span><span class="s1">&#39;__class__&#39;</span><span class="p">,</span> <span class="s1">&#39;__doc__&#39;</span><span class="p">,</span> <span class="s1">&#39;__members__&#39;</span><span class="p">,</span> <span class="s1">&#39;__module__&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_member_names_</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">__members__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a mapping of member name-&gt;value.</span>

<span class="sd">        This mapping lists all enum members, including aliases. Note that this</span>
<span class="sd">        is a copy of the internal mapping.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_member_map_</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_member_map_</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">exc</span> <span class="o">=</span> <span class="n">_sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">Flag</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;|&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># may be an __or__ed name</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">):</span>
                    <span class="n">result</span> <span class="o">|=</span> <span class="bp">cls</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">result</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">exc</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_missing_name_</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exc</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_member_map_</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_member_names_</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__reversed__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_member_map_</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_member_names_</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_member_names_</span><span class="p">)</span>

    <span class="n">__nonzero__</span> <span class="o">=</span> <span class="fm">__bool__</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;aenum </span><span class="si">%r</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Block attempts to reassign Enum members/constants.</span>

<span class="sd">        A simple assignment to the class namespace only changes one of the</span>
<span class="sd">        several possible ways to get an Enum member from the Enum class,</span>
<span class="sd">        resulting in an inconsistent Enumeration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">member_map</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_member_map_&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">member_map</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                    <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: cannot rebind member </span><span class="si">%r</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span>
                    <span class="p">)</span>
        <span class="n">cur_obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cur_obj</span><span class="p">,</span> <span class="n">constant</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                    <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: cannot rebind constant </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span>
                    <span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">EnumMeta</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convenience method to create a new Enum class.</span>

<span class="sd">        `names` can be:</span>

<span class="sd">        * A string containing member names, separated either with spaces or</span>
<span class="sd">          commas.  Values are auto-numbered from 1.</span>
<span class="sd">        * An iterable of member names.  Values are auto-numbered from 1.</span>
<span class="sd">        * An iterable of (member name, value) pairs.</span>
<span class="sd">        * A mapping of member name -&gt; value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pyver</span> <span class="o">&lt;</span> <span class="mf">3.0</span><span class="p">:</span>
            <span class="c1"># if class_name is unicode, attempt a conversion to ASCII</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">class_name</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">class_name</span> <span class="o">=</span> <span class="n">class_name</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">UnicodeEncodeError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%r</span><span class="s1"> is not representable in ASCII&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">class_name</span><span class="p">,</span> <span class="p">))</span>
        <span class="n">metacls</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bases</span> <span class="o">=</span> <span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bases</span> <span class="o">=</span> <span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">first_enum</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_mixins_</span><span class="p">(</span><span class="n">bases</span><span class="p">)</span>
        <span class="n">generate</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">first_enum</span><span class="p">,</span> <span class="s1">&#39;_generate_next_value_&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">generate</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">generate</span><span class="p">,</span> <span class="s1">&#39;im_func&#39;</span><span class="p">,</span> <span class="n">generate</span><span class="p">)</span>
        <span class="c1"># special processing needed for names?</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">names</span> <span class="o">=</span> <span class="n">names</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">and</span> <span class="n">names</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">original_names</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="n">names</span><span class="p">,</span> <span class="p">[]</span>
            <span class="n">last_values</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">original_names</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">generate</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">last_values</span><span class="p">[:])</span>
                <span class="n">last_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="c1"># Here, names is either an iterable of (name, value) or a mapping.</span>
        <span class="n">item</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># in case names is empty</span>
        <span class="n">clsdict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">clsdict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># first time initialization</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                    <span class="n">clsdict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># remember the order</span>
                    <span class="n">clsdict</span> <span class="o">=</span> <span class="n">metacls</span><span class="o">.</span><span class="fm">__prepare__</span><span class="p">(</span><span class="n">class_name</span><span class="p">,</span> <span class="n">bases</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                <span class="n">member_name</span><span class="p">,</span> <span class="n">member_value</span> <span class="o">=</span> <span class="n">item</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">member_name</span><span class="p">,</span> <span class="n">member_value</span> <span class="o">=</span> <span class="n">item</span>
            <span class="n">clsdict</span><span class="p">[</span><span class="n">member_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">member_value</span>
        <span class="k">if</span> <span class="n">clsdict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># in case names was empty</span>
            <span class="n">clsdict</span> <span class="o">=</span> <span class="n">metacls</span><span class="o">.</span><span class="fm">__prepare__</span><span class="p">(</span><span class="n">class_name</span><span class="p">,</span> <span class="n">bases</span><span class="p">)</span>
        <span class="n">enum_class</span> <span class="o">=</span> <span class="n">metacls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">metacls</span><span class="p">,</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">clsdict</span><span class="p">)</span>
        <span class="c1"># TODO: replace the frame hack if a blessed way to know the calling</span>
        <span class="c1"># module is ever developed</span>
        <span class="k">if</span> <span class="n">module</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">module</span> <span class="o">=</span> <span class="n">_sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">f_globals</span><span class="p">[</span><span class="s1">&#39;__name__&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="n">module</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_make_class_unpicklable</span><span class="p">(</span><span class="n">enum_class</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">enum_class</span><span class="o">.</span><span class="vm">__module__</span> <span class="o">=</span> <span class="n">module</span>
        <span class="k">return</span> <span class="n">enum_class</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_mixins_</span><span class="p">(</span><span class="n">bases</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the type for creating enum members, and the first inherited</span>
<span class="sd">        enum class.</span>

<span class="sd">        bases: the tuple of bases that was given to __new__</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">bases</span> <span class="ow">or</span> <span class="n">Enum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">object</span><span class="p">,</span> <span class="n">Enum</span>
        <span class="k">def</span> <span class="nf">_find_data_type</span><span class="p">(</span><span class="n">bases</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">chain</span><span class="o">.</span><span class="vm">__mro__</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">base</span> <span class="ow">is</span> <span class="nb">object</span> <span class="ow">or</span> <span class="n">base</span> <span class="ow">is</span> <span class="n">StdlibEnum</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">elif</span> <span class="s1">&#39;__new__&#39;</span> <span class="ow">in</span> <span class="n">base</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
                            <span class="k">continue</span>
                        <span class="k">return</span> <span class="n">base</span>

        <span class="c1"># ensure final parent class is an Enum derivative, find any concrete</span>
        <span class="c1"># data type, and check that Enum has no members</span>
        <span class="n">first_enum</span> <span class="o">=</span> <span class="n">bases</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">first_enum</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;new enumerations should be created as &quot;</span>
                    <span class="s2">&quot;`EnumName([mixin_type, ...] [data_type,] enum_type)`&quot;</span><span class="p">)</span>
        <span class="n">member_type</span> <span class="o">=</span> <span class="n">_find_data_type</span><span class="p">(</span><span class="n">bases</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">object</span>
        <span class="k">if</span> <span class="n">first_enum</span><span class="o">.</span><span class="n">_member_names_</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;cannot extend enumerations via subclassing&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">member_type</span><span class="p">,</span> <span class="n">first_enum</span>

    <span class="k">if</span> <span class="n">pyver</span> <span class="o">&lt;</span> <span class="mf">3.0</span><span class="p">:</span>
        <span class="nd">@staticmethod</span>
        <span class="k">def</span> <span class="nf">_find_new_</span><span class="p">(</span><span class="n">clsdict</span><span class="p">,</span> <span class="n">member_type</span><span class="p">,</span> <span class="n">first_enum</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Returns the __new__ to be used for creating the enum members.</span>

<span class="sd">            clsdict: the class dictionary given to __new__</span>
<span class="sd">            member_type: the data type whose __new__ will be used by default</span>
<span class="sd">            first_enum: enumeration to check for an overriding __new__</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># now find the correct __new__, checking to see of one was defined</span>
            <span class="c1"># by the user; also check earlier enum classes in case a __new__ was</span>
            <span class="c1"># saved as __new_member__</span>
            <span class="fm">__new__</span> <span class="o">=</span> <span class="n">clsdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__new__&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="fm">__new__</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span>      <span class="c1"># __new__, save_new, new_uses_args</span>

            <span class="n">N__new__</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;__new__&#39;</span><span class="p">)</span>
            <span class="n">O__new__</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="s1">&#39;__new__&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">Enum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">E__new__</span> <span class="o">=</span> <span class="n">N__new__</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">E__new__</span> <span class="o">=</span> <span class="n">Enum</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;__new__&#39;</span><span class="p">]</span>
            <span class="c1"># check all possibles for __new_member__ before falling back to</span>
            <span class="c1"># __new__</span>
            <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;__new_member__&#39;</span><span class="p">,</span> <span class="s1">&#39;__new__&#39;</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">possible</span> <span class="ow">in</span> <span class="p">(</span><span class="n">member_type</span><span class="p">,</span> <span class="n">first_enum</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">target</span> <span class="o">=</span> <span class="n">possible</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">method</span><span class="p">]</span>
                    <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
                        <span class="n">target</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">possible</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">target</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
                            <span class="kc">None</span><span class="p">,</span>
                            <span class="n">N__new__</span><span class="p">,</span>
                            <span class="n">O__new__</span><span class="p">,</span>
                            <span class="n">E__new__</span><span class="p">,</span>
                            <span class="p">]:</span>
                        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;__new_member__&#39;</span><span class="p">:</span>
                            <span class="n">clsdict</span><span class="p">[</span><span class="s1">&#39;__new__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span>
                            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">staticmethod</span><span class="p">):</span>
                            <span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="n">member_type</span><span class="p">)</span>
                        <span class="fm">__new__</span> <span class="o">=</span> <span class="n">target</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="fm">__new__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="fm">__new__</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span>

            <span class="c1"># if a non-object.__new__ is used then whatever value/tuple was</span>
            <span class="c1"># assigned to the enum member name will be passed to __new__ and to the</span>
            <span class="c1"># new enum member&#39;s __init__</span>
            <span class="k">if</span> <span class="fm">__new__</span> <span class="ow">is</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">:</span>
                <span class="n">new_uses_args</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_uses_args</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">return</span> <span class="fm">__new__</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">new_uses_args</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nd">@staticmethod</span>
        <span class="k">def</span> <span class="nf">_find_new_</span><span class="p">(</span><span class="n">clsdict</span><span class="p">,</span> <span class="n">member_type</span><span class="p">,</span> <span class="n">first_enum</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Returns the __new__ to be used for creating the enum members.</span>

<span class="sd">            clsdict: the class dictionary given to __new__</span>
<span class="sd">            member_type: the data type whose __new__ will be used by default</span>
<span class="sd">            first_enum: enumeration to check for an overriding __new__</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># now find the correct __new__, checking to see of one was defined</span>
            <span class="c1"># by the user; also check earlier enum classes in case a __new__ was</span>
            <span class="c1"># saved as __new_member__</span>
            <span class="fm">__new__</span> <span class="o">=</span> <span class="n">clsdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__new__&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="c1"># should __new__ be saved as __new_member__ later?</span>
            <span class="n">save_new</span> <span class="o">=</span> <span class="fm">__new__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="fm">__new__</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># check all possibles for __new_member__ before falling back to</span>
                <span class="c1"># __new__</span>
                <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;__new_member__&#39;</span><span class="p">,</span> <span class="s1">&#39;__new__&#39;</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">possible</span> <span class="ow">in</span> <span class="p">(</span><span class="n">member_type</span><span class="p">,</span> <span class="n">first_enum</span><span class="p">):</span>
                        <span class="n">target</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">possible</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">target</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span>
                                <span class="kc">None</span><span class="p">,</span>
                                <span class="kc">None</span><span class="o">.</span><span class="fm">__new__</span><span class="p">,</span>
                                <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">,</span>
                                <span class="n">Enum</span><span class="o">.</span><span class="fm">__new__</span><span class="p">,</span>
                                <span class="n">StdlibEnum</span><span class="o">.</span><span class="fm">__new__</span>
                                <span class="p">):</span>
                            <span class="fm">__new__</span> <span class="o">=</span> <span class="n">target</span>
                            <span class="k">break</span>
                    <span class="k">if</span> <span class="fm">__new__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="fm">__new__</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span>
            <span class="c1"># if a non-object.__new__ is used then whatever value/tuple was</span>
            <span class="c1"># assigned to the enum member name will be passed to __new__ and to the</span>
            <span class="c1"># new enum member&#39;s __init__</span>
            <span class="k">if</span> <span class="fm">__new__</span> <span class="ow">is</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">:</span>
                <span class="n">new_uses_args</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_uses_args</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">return</span> <span class="fm">__new__</span><span class="p">,</span> <span class="n">save_new</span><span class="p">,</span> <span class="n">new_uses_args</span>


<span class="c1">########################################################</span>
<span class="c1"># In order to support Python 2 and 3 with a single</span>
<span class="c1"># codebase we have to create the Enum methods separately</span>
<span class="c1"># and then use the `type(name, bases, dict)` method to</span>
<span class="c1"># create the class.</span>
<span class="c1">########################################################</span>
<span class="n">temp_enum_dict</span> <span class="o">=</span> <span class="n">EnumMeta</span><span class="o">.</span><span class="fm">__prepare__</span><span class="p">(</span><span class="s1">&#39;Enum&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="p">))</span>
<span class="n">temp_enum_dict</span><span class="p">[</span><span class="s1">&#39;__doc__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Generic enumeration.</span><span class="se">\n\n</span><span class="s2">    Derive from this class to define new enumerations.</span><span class="se">\n\n</span><span class="s2">&quot;</span>

<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
    <span class="c1"># auto-init method</span>
    <span class="n">_auto_init_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auto_init_</span>
    <span class="k">if</span> <span class="n">_auto_init_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="s1">&#39;value&#39;</span> <span class="ow">in</span> <span class="n">_auto_init_</span><span class="p">:</span>
        <span class="c1"># remove &#39;value&#39; from _auto_init_ as it has already been handled</span>
        <span class="n">_auto_init_</span> <span class="o">=</span> <span class="n">_auto_init_</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">if</span> <span class="n">_auto_init_</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_auto_init_</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> arguments expected (</span><span class="si">%s</span><span class="s1">), </span><span class="si">%d</span><span class="s1"> received (</span><span class="si">%s</span><span class="s1">)&#39;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_auto_init_</span><span class="p">),</span> <span class="n">_auto_init_</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">),</span> <span class="n">args</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">_auto_init_</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">_auto_init_</span><span class="p">):</span>
            <span class="n">remaining_args</span> <span class="o">=</span> <span class="n">_auto_init_</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">):]</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">remaining_args</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">undefined</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">undefined</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;missing value for: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">))</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">kwds</span><span class="p">:</span>
                <span class="c1"># too many keyword arguments</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;invalid keyword(s): </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">kwds</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="n">temp_enum_dict</span><span class="p">[</span><span class="s1">&#39;__init__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="fm">__init__</span>
<span class="k">del</span> <span class="fm">__init__</span>

<span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="c1"># all enum instances are actually created during class construction</span>
    <span class="c1"># without calling this method; this method is called by the metaclass&#39;</span>
    <span class="c1"># __call__ (i.e. Color(3) ), and by pickle</span>
    <span class="k">if</span> <span class="n">NoAlias</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_settings_</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;NoAlias enumerations cannot be looked up by value&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">cls</span><span class="p">:</span>
        <span class="c1"># For lookups like Color(Color.red)</span>
        <span class="c1"># value = value.value</span>
        <span class="k">return</span> <span class="n">value</span>
    <span class="c1"># by-value search for a matching enum member</span>
    <span class="c1"># see if it&#39;s in the reverse mapping (for hashable values)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_value2member_map_</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_value2member_map_</span><span class="p">[</span><span class="n">value</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="c1"># not there, now do long search -- O(n) behavior</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">member</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_value2member_seq_</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">member</span>
    <span class="c1"># still not found -- try _missing_ hook</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">exc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_missing_value_</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">exc</span> <span class="o">=</span> <span class="n">e</span>
        <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">no_arg</span><span class="p">:</span>
            <span class="n">ve_exc</span> <span class="o">=</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">() should be called with a value&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ve_exc</span> <span class="o">=</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%r</span><span class="s2"> is not a valid </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">exc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ve_exc</span>
        <span class="k">elif</span> <span class="n">exc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exc</span> <span class="o">=</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s1">&#39;error in </span><span class="si">%s</span><span class="s1">._missing_: returned </span><span class="si">%r</span><span class="s1"> instead of None or a valid member&#39;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
                    <span class="p">)</span>
        <span class="n">exc</span><span class="o">.</span><span class="n">__context__</span> <span class="o">=</span> <span class="n">ve_exc</span>
        <span class="k">raise</span> <span class="n">exc</span>
<span class="n">temp_enum_dict</span><span class="p">[</span><span class="s1">&#39;__new__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="fm">__new__</span>
<span class="k">del</span> <span class="fm">__new__</span>

<span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">_generate_next_value_</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">last_values</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">last_value</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">last_values</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">last_value</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">start</span>
<span class="n">temp_enum_dict</span><span class="p">[</span><span class="s1">&#39;_generate_next_value_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_generate_next_value_</span>
<span class="k">del</span> <span class="n">_generate_next_value_</span>

<span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">_missing_</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="s2">&quot;deprecated, use _missing_value_ instead&quot;</span>
    <span class="k">return</span> <span class="kc">None</span>
<span class="n">temp_enum_dict</span><span class="p">[</span><span class="s1">&#39;_missing_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_missing_</span>
<span class="k">del</span> <span class="n">_missing_</span>

<span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">_missing_value_</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="s2">&quot;used for failed value access&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_missing_</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<span class="n">temp_enum_dict</span><span class="p">[</span><span class="s1">&#39;_missing_value_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_missing_value_</span>
<span class="k">del</span> <span class="n">_missing_value_</span>

<span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">_missing_name_</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="s2">&quot;used for failed item access&quot;</span>
    <span class="k">return</span> <span class="kc">None</span>
<span class="n">temp_enum_dict</span><span class="p">[</span><span class="s1">&#39;_missing_name_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_missing_name_</span>
<span class="k">del</span> <span class="n">_missing_name_</span>

<span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">: </span><span class="si">%r</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value_</span><span class="p">)</span>
<span class="n">temp_enum_dict</span><span class="p">[</span><span class="s1">&#39;__repr__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="fm">__repr__</span>
<span class="k">del</span> <span class="fm">__repr__</span>

<span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name_</span><span class="p">)</span>
<span class="n">temp_enum_dict</span><span class="p">[</span><span class="s1">&#39;__str__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="fm">__str__</span>
<span class="k">del</span> <span class="fm">__str__</span>

<span class="k">if</span> <span class="n">pyver</span> <span class="o">&gt;=</span> <span class="mf">3.0</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">added_behavior</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">m</span>
                <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">mro</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__dict__</span>
                <span class="k">if</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;_&#39;</span> <span class="ow">and</span> <span class="n">m</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_member_map_</span>
                <span class="p">]</span>
        <span class="k">return</span> <span class="p">([</span><span class="s1">&#39;__class__&#39;</span><span class="p">,</span> <span class="s1">&#39;__doc__&#39;</span><span class="p">,</span> <span class="s1">&#39;__module__&#39;</span><span class="p">,</span> <span class="p">]</span> <span class="o">+</span> <span class="n">added_behavior</span><span class="p">)</span>
    <span class="n">temp_enum_dict</span><span class="p">[</span><span class="s1">&#39;__dir__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="fm">__dir__</span>
    <span class="k">del</span> <span class="fm">__dir__</span>

<span class="k">def</span> <span class="fm">__format__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">format_spec</span><span class="p">):</span>
    <span class="c1"># mixed-in Enums should use the mixed-in type&#39;s __format__, otherwise</span>
    <span class="c1"># we can get strange results with the Enum name showing up instead of</span>
    <span class="c1"># the value</span>

    <span class="c1"># pure Enum branch / overridden __str__ branch</span>
    <span class="n">overridden_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="fm">__str__</span> <span class="o">!=</span> <span class="n">Enum</span><span class="o">.</span><span class="fm">__str__</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_member_type_</span> <span class="ow">is</span> <span class="nb">object</span> <span class="ow">or</span> <span class="n">overridden_str</span><span class="p">:</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="nb">str</span>
        <span class="n">val</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="c1"># mix-in branch</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_member_type_</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__format__</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">format_spec</span><span class="p">)</span>
<span class="n">temp_enum_dict</span><span class="p">[</span><span class="s1">&#39;__format__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="fm">__format__</span>
<span class="k">del</span> <span class="fm">__format__</span>

<span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name_</span><span class="p">)</span>
<span class="n">temp_enum_dict</span><span class="p">[</span><span class="s1">&#39;__hash__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="fm">__hash__</span>
<span class="k">del</span> <span class="fm">__hash__</span>

<span class="k">def</span> <span class="nf">__reduce_ex__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proto</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value_</span><span class="p">,</span> <span class="p">)</span>
<span class="n">temp_enum_dict</span><span class="p">[</span><span class="s1">&#39;__reduce_ex__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">__reduce_ex__</span>
<span class="k">del</span> <span class="n">__reduce_ex__</span>


<span class="c1">####################################</span>
<span class="c1"># Python&#39;s less than 2.6 use __cmp__</span>

<span class="k">if</span> <span class="n">pyver</span> <span class="o">&lt;</span> <span class="mf">2.6</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__cmp__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">other</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">0</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;unorderable types: </span><span class="si">%s</span><span class="s2">() and </span><span class="si">%s</span><span class="s2">()&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
    <span class="n">temp_enum_dict</span><span class="p">[</span><span class="s1">&#39;__cmp__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">__cmp__</span>
    <span class="k">del</span> <span class="n">__cmp__</span>

<span class="k">else</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;unorderable types: </span><span class="si">%s</span><span class="s2">() &lt;= </span><span class="si">%s</span><span class="s2">()&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
    <span class="n">temp_enum_dict</span><span class="p">[</span><span class="s1">&#39;__le__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="fm">__le__</span>
    <span class="k">del</span> <span class="fm">__le__</span>

    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;unorderable types: </span><span class="si">%s</span><span class="s2">() &lt; </span><span class="si">%s</span><span class="s2">()&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
    <span class="n">temp_enum_dict</span><span class="p">[</span><span class="s1">&#39;__lt__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="fm">__lt__</span>
    <span class="k">del</span> <span class="fm">__lt__</span>

    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;unorderable types: </span><span class="si">%s</span><span class="s2">() &gt;= </span><span class="si">%s</span><span class="s2">()&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
    <span class="n">temp_enum_dict</span><span class="p">[</span><span class="s1">&#39;__ge__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="fm">__ge__</span>
    <span class="k">del</span> <span class="fm">__ge__</span>

    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;unorderable types: </span><span class="si">%s</span><span class="s2">() &gt; </span><span class="si">%s</span><span class="s2">()&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
    <span class="n">temp_enum_dict</span><span class="p">[</span><span class="s1">&#39;__gt__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="fm">__gt__</span>
    <span class="k">del</span> <span class="fm">__gt__</span>


<span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">other</span>
    <span class="k">return</span> <span class="bp">NotImplemented</span>
<span class="n">temp_enum_dict</span><span class="p">[</span><span class="s1">&#39;__eq__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="fm">__eq__</span>
<span class="k">del</span> <span class="fm">__eq__</span>

<span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">other</span>
    <span class="k">return</span> <span class="bp">NotImplemented</span>
<span class="n">temp_enum_dict</span><span class="p">[</span><span class="s1">&#39;__ne__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="fm">__ne__</span>
<span class="k">del</span> <span class="fm">__ne__</span>

<span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name_</span><span class="p">)</span>
<span class="n">temp_enum_dict</span><span class="p">[</span><span class="s1">&#39;__hash__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="fm">__hash__</span>
<span class="k">del</span> <span class="fm">__hash__</span>

<span class="k">def</span> <span class="nf">__reduce_ex__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proto</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value_</span><span class="p">,</span> <span class="p">)</span>
<span class="n">temp_enum_dict</span><span class="p">[</span><span class="s1">&#39;__reduce_ex__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">__reduce_ex__</span>
<span class="k">del</span> <span class="n">__reduce_ex__</span>

<span class="k">def</span> <span class="nf">_convert</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new Enum subclass that replaces a collection of global constants</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># convert all constants from source (or module) that pass filter() to</span>
    <span class="c1"># a new Enum called name, and export the enum and its members back to</span>
    <span class="c1"># module;</span>
    <span class="c1"># also, replace the __reduce_ex__ method so unpickling works in</span>
    <span class="c1"># previous Python versions</span>
    <span class="n">module_globals</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">_sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">module</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">source</span><span class="p">:</span>
        <span class="n">source</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">module_globals</span>
    <span class="n">members</span> <span class="o">=</span> <span class="p">[(</span><span class="n">key</span><span class="p">,</span> <span class="n">source</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">source</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="nb">filter</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># sort by value, name</span>
        <span class="n">members</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="c1"># unless some values aren&#39;t comparable, in which case sort by just name</span>
        <span class="n">members</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="bp">cls</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">members</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="n">module</span><span class="p">)</span>
    <span class="bp">cls</span><span class="o">.</span><span class="n">__reduce_ex__</span> <span class="o">=</span> <span class="n">_reduce_ex_by_name</span>
    <span class="n">module_globals</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">__members__</span><span class="p">)</span>
    <span class="n">module_globals</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span>
    <span class="k">return</span> <span class="bp">cls</span>
<span class="n">temp_enum_dict</span><span class="p">[</span><span class="s1">&#39;_convert&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span><span class="n">_convert</span><span class="p">)</span>
<span class="k">del</span> <span class="n">_convert</span>

<span class="c1"># enum_property is used to provide access to the `name`, `value&#39;, etc.,</span>
<span class="c1"># properties of enum members while keeping some measure of protection</span>
<span class="c1"># from modification, while still allowing for an enumeration to have</span>
<span class="c1"># members named `name`, `value`, etc..  This works because enumeration</span>
<span class="c1"># members are not set directly on the enum class -- enum_property will</span>
<span class="c1"># look them up in _member_map_.</span>

<span class="nd">@enum_property</span>
<span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name_</span>
<span class="n">temp_enum_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
<span class="k">del</span> <span class="n">name</span>

<span class="nd">@enum_property</span>
<span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value_</span>
<span class="n">temp_enum_dict</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<span class="k">del</span> <span class="n">value</span>

<span class="nd">@enum_property</span>
<span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_values_</span>
<span class="n">temp_enum_dict</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>
<span class="k">del</span> <span class="n">values</span>

<span class="k">def</span> <span class="nf">_reduce_ex_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proto</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

<span class="k">if</span> <span class="n">StdlibEnum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">Enum</span> <span class="o">=</span> <span class="n">EnumMeta</span><span class="p">(</span><span class="s1">&#39;Enum&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">StdlibEnum</span><span class="p">,</span> <span class="p">),</span> <span class="n">temp_enum_dict</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">Enum</span> <span class="o">=</span> <span class="n">EnumMeta</span><span class="p">(</span><span class="s1">&#39;Enum&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="p">),</span> <span class="n">temp_enum_dict</span><span class="p">)</span>
<span class="k">del</span> <span class="n">temp_enum_dict</span>

<span class="c1"># Enum has now been created</span>
<span class="c1">###########################</span>

<span class="k">class</span> <span class="nc">IntEnum</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Enum where members are also (and must be) ints&quot;&quot;&quot;</span>

<span class="k">class</span> <span class="nc">StrEnum</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot;Enum where members are also (and must already be) strings</span>
<span class="sd">    </span>
<span class="sd">        default value is member name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">or</span> <span class="n">kwds</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;only a single string value may be specified&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;values for StrEnum must be strings, not </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_value_</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">obj</span>
    <span class="k">def</span> <span class="nf">_generate_next_value_</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">last_values</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">name</span>

<span class="k">class</span> <span class="nc">LowerStrEnum</span><span class="p">(</span><span class="n">StrEnum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Enum where members are also (and must already be) lower-case strings</span>
<span class="sd">    </span>
<span class="sd">        default value is member name, lower-cased</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">StrEnum</span><span class="o">.</span><span class="n">__new_member__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%r</span><span class="s1"> is not lower-case&#39;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span>
    <span class="k">def</span> <span class="nf">_generate_next_value_</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">last_values</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">UpperStrEnum</span><span class="p">(</span><span class="n">StrEnum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Enum where members are also (and must already be) upper-case strings</span>
<span class="sd">    </span>
<span class="sd">        default value is member name, upper-cased</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">StrEnum</span><span class="o">.</span><span class="n">__new_member__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="n">value</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%r</span><span class="s1"> is not upper-case&#39;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span>
    <span class="k">def</span> <span class="nf">_generate_next_value_</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">last_values</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

<span class="k">if</span> <span class="n">pyver</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
    <span class="k">class</span> <span class="nc">AutoEnum</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        automatically use _generate_next_value_ when values are missing (Python 3 only)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_settings_</span> <span class="o">=</span> <span class="n">AutoValue</span>

<span class="k">class</span> <span class="nc">AutoNumberEnum</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Automatically assign increasing values to members.</span>

<span class="sd">    Py3: numbers match creation order</span>
<span class="sd">    Py2: numbers are assigned alphabetically by member name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">__members__</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_value_</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">obj</span>

<span class="k">class</span> <span class="nc">MultiValueEnum</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Multiple values can map to each member.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_settings_</span> <span class="o">=</span> <span class="n">MultiValue</span>

<span class="k">class</span> <span class="nc">NoAliasEnum</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Duplicate value members are distinct, but cannot be looked up by value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_settings_</span> <span class="o">=</span> <span class="n">NoAlias</span>

<span class="k">class</span> <span class="nc">OrderedEnum</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add ordering based on values of Enum members.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">is</span> <span class="n">other</span><span class="o">.</span><span class="vm">__class__</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value_</span> <span class="o">&gt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">_value_</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">is</span> <span class="n">other</span><span class="o">.</span><span class="vm">__class__</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value_</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">_value_</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">is</span> <span class="n">other</span><span class="o">.</span><span class="vm">__class__</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value_</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">_value_</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">is</span> <span class="n">other</span><span class="o">.</span><span class="vm">__class__</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value_</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">_value_</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

<span class="k">if</span> <span class="n">sqlite3</span><span class="p">:</span>
    <span class="k">class</span> <span class="nc">SqliteEnum</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">__conform__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">protocol</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">protocol</span> <span class="ow">is</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">PrepareProtocol</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

<span class="k">class</span> <span class="nc">UniqueEnum</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensure no duplicate values exist.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_settings_</span> <span class="o">=</span> <span class="n">Unique</span>


<span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="n">enum</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new Enum subclass that replaces a collection of global constants</span>

<span class="sd">    enum: Enum, IntEnum, ...</span>
<span class="sd">    name: name of new Enum</span>
<span class="sd">    module: name of module (__name__ in global context)</span>
<span class="sd">    filter: function that returns True if name should be converted to Enum member</span>
<span class="sd">    source: namespace to check (defaults to &#39;module&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># convert all constants from source (or module) that pass filter() to</span>
    <span class="c1"># a new Enum called name, and export the enum and its members back to</span>
    <span class="c1"># module;</span>
    <span class="c1"># also, replace the __reduce_ex__ method so unpickling works in</span>
    <span class="c1"># previous Python versions</span>
    <span class="n">module_globals</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">_sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">module</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">source</span><span class="p">:</span>
        <span class="n">source</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">module_globals</span>
    <span class="n">members</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">source</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">filter</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
    <span class="n">enum</span> <span class="o">=</span> <span class="n">enum</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">members</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="n">module</span><span class="p">)</span>
    <span class="n">enum</span><span class="o">.</span><span class="n">__reduce_ex__</span> <span class="o">=</span> <span class="n">_reduce_ex_by_name</span>
    <span class="n">module_globals</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">__members__</span><span class="p">)</span>
    <span class="n">module_globals</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">enum</span>

<span class="k">def</span> <span class="nf">extend_enum</span><span class="p">(</span><span class="n">enumeration</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">_private_kwds</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a new member to an existing Enum.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">_member_map_</span> <span class="o">=</span> <span class="n">enumeration</span><span class="o">.</span><span class="n">_member_map_</span>
        <span class="n">_member_names_</span> <span class="o">=</span> <span class="n">enumeration</span><span class="o">.</span><span class="n">_member_names_</span>
        <span class="n">_member_type_</span> <span class="o">=</span> <span class="n">enumeration</span><span class="o">.</span><span class="n">_member_type_</span>
        <span class="n">_value2member_map_</span> <span class="o">=</span> <span class="n">enumeration</span><span class="o">.</span><span class="n">_value2member_map_</span>
        <span class="n">base_attributes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">enumeration</span><span class="o">.</span><span class="n">mro</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">b</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%r</span><span class="s1"> is not a supported Enum&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">enumeration</span><span class="p">,</span> <span class="p">))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">_value2member_seq_</span> <span class="o">=</span> <span class="n">enumeration</span><span class="o">.</span><span class="n">_value2member_seq_</span>
        <span class="c1"># _auto_number_ = enumeration._auto_number_</span>
        <span class="n">_multi_value_</span> <span class="o">=</span> <span class="n">MultiValue</span> <span class="ow">in</span> <span class="n">enumeration</span><span class="o">.</span><span class="n">_settings_</span>
        <span class="n">_no_alias_</span> <span class="o">=</span> <span class="n">NoAlias</span> <span class="ow">in</span> <span class="n">enumeration</span><span class="o">.</span><span class="n">_settings_</span>
        <span class="n">_unique_</span> <span class="o">=</span> <span class="n">Unique</span> <span class="ow">in</span> <span class="n">enumeration</span><span class="o">.</span><span class="n">_settings_</span>
        <span class="c1"># _unique_ = Unique in enumeration._settings_</span>
        <span class="n">_auto_init_</span> <span class="o">=</span> <span class="n">enumeration</span><span class="o">.</span><span class="n">_auto_init_</span> <span class="ow">or</span> <span class="p">[]</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="c1"># standard Enum</span>
        <span class="n">_value2member_seq_</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># _auto_number_ = False</span>
        <span class="n">_multi_value_</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">_no_alias_</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># _unique_ = False</span>
        <span class="n">_auto_init_</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mt_new</span> <span class="o">=</span> <span class="n">_member_type_</span><span class="o">.</span><span class="fm">__new__</span>
    <span class="n">_new</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">enumeration</span><span class="p">,</span> <span class="s1">&#39;__new_member__&#39;</span><span class="p">,</span> <span class="n">mt_new</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
        <span class="n">_gnv</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">enumeration</span><span class="p">,</span> <span class="s1">&#39;_generate_next_value_&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_gnv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;value not provided and _generate_next_value_ missing&#39;</span><span class="p">)</span>
        <span class="n">last_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">enumeration</span><span class="p">]</span>
        <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">enumeration</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">enumeration</span><span class="p">,</span> <span class="s1">&#39;_start_&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">last_values</span> <span class="ow">and</span> <span class="n">last_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="mi">1</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span> <span class="n">_gnv</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">last_values</span><span class="p">),</span> <span class="p">)</span>
    <span class="k">if</span> <span class="n">_new</span> <span class="ow">is</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">:</span>
        <span class="n">new_uses_args</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_uses_args</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">args</span>
    <span class="n">more_values</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">kwds</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">enum</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">args</span>
        <span class="n">kwds</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">kwds</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">value</span>
    <span class="c1"># tease value out of auto-init if specified</span>
    <span class="k">if</span> <span class="s1">&#39;value&#39;</span> <span class="ow">in</span> <span class="n">_auto_init_</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;value&#39;</span> <span class="ow">in</span> <span class="n">kwds</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">elif</span> <span class="n">_multi_value_</span><span class="p">:</span>
        <span class="n">value</span><span class="p">,</span> <span class="n">more_values</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="p">()</span>
    <span class="k">if</span> <span class="n">_member_type_</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">new_uses_args</span><span class="p">:</span>
        <span class="n">new_member</span> <span class="o">=</span> <span class="n">_new</span><span class="p">(</span><span class="n">enumeration</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">new_member</span><span class="p">,</span> <span class="s1">&#39;_value_&#39;</span><span class="p">):</span>
            <span class="n">new_member</span><span class="o">.</span><span class="n">_value_</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_member</span> <span class="o">=</span> <span class="n">_new</span><span class="p">(</span><span class="n">enumeration</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">new_member</span><span class="p">,</span> <span class="s1">&#39;_value_&#39;</span><span class="p">):</span>
            <span class="n">new_member</span><span class="o">.</span><span class="n">_value_</span> <span class="o">=</span> <span class="n">_member_type_</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">new_member</span><span class="o">.</span><span class="n">_value_</span>
    <span class="n">new_member</span><span class="o">.</span><span class="n">_name_</span> <span class="o">=</span> <span class="n">name</span>
    <span class="n">new_member</span><span class="o">.</span><span class="vm">__objclass__</span> <span class="o">=</span> <span class="n">enumeration</span><span class="o">.</span><span class="vm">__class__</span>
    <span class="n">new_member</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_private_kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;create_only&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">new_member</span>
    <span class="c1"># If another member with the same value was already defined, the</span>
    <span class="c1"># new member becomes an alias to the existing one.</span>
    <span class="n">is_alias</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">_no_alias_</span><span class="p">:</span>
        <span class="c1"># unless NoAlias was specified</span>
        <span class="n">_member_names_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">_member_map_</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_member</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">canonical_member</span> <span class="ow">in</span> <span class="n">_member_map_</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">_values_</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">canonical_member</span><span class="p">,</span> <span class="s1">&#39;_values_&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">canonical_member</span><span class="o">.</span><span class="n">_value_</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">canonical_value</span> <span class="ow">in</span> <span class="n">_values_</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">canonical_value</span> <span class="o">==</span> <span class="n">new_member</span><span class="o">.</span><span class="n">_value_</span><span class="p">:</span>
                    <span class="c1"># name is an alias</span>
                    <span class="k">if</span> <span class="n">_unique_</span> <span class="ow">or</span> <span class="n">_multi_value_</span><span class="p">:</span>
                        <span class="c1"># aliases not allowed if Unique specified</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> is a duplicate of </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">canonical_member</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">base_attributes</span><span class="p">:</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="n">enumeration</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">canonical_member</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># check type of name</span>
                        <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">enumeration</span><span class="o">.</span><span class="n">mro</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]:</span>
                            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">parent</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
                                <span class="n">obj</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">enum_property</span><span class="p">):</span>
                                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%r</span><span class="s1"> already used: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="p">))</span>
                                <span class="k">break</span>
                    <span class="c1"># Aliases don&#39;t appear in member names (only in __members__ and _member_map_).</span>
                    <span class="n">_member_map_</span><span class="p">[</span><span class="n">new_member</span><span class="o">.</span><span class="n">_name_</span><span class="p">]</span> <span class="o">=</span> <span class="n">canonical_member</span>
                    <span class="n">new_member</span> <span class="o">=</span> <span class="n">canonical_member</span>
                    <span class="n">is_alias</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="n">is_alias</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># not an alias</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">)</span> <span class="o">+</span> <span class="n">more_values</span>
            <span class="n">new_member</span><span class="o">.</span><span class="n">_values_</span> <span class="o">=</span> <span class="n">values</span>
            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">)</span> <span class="o">+</span> <span class="n">more_values</span><span class="p">:</span>
                <span class="c1"># first check if value has already been used</span>
                <span class="k">if</span> <span class="n">_multi_value_</span> <span class="ow">and</span> <span class="p">(</span>
                        <span class="n">value</span> <span class="ow">in</span> <span class="n">_value2member_map_</span>
                        <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="n">v</span> <span class="o">==</span> <span class="n">value</span> <span class="k">for</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="ow">in</span> <span class="n">_value2member_seq_</span><span class="p">)</span>
                        <span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%r</span><span class="s1"> has already been used&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">))</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># This may fail if value is not hashable. We can&#39;t add the value</span>
                    <span class="c1"># to the map, and by-value lookups for this value will be</span>
                    <span class="c1"># linear.</span>
                    <span class="k">if</span> <span class="n">_no_alias_</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;cannot use dict to store value&#39;</span><span class="p">)</span>
                    <span class="n">_value2member_map_</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_member</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="n">_value2member_seq_</span> <span class="o">+=</span> <span class="p">((</span><span class="n">value</span><span class="p">,</span> <span class="n">new_member</span><span class="p">),</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">base_attributes</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">enumeration</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">new_member</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># check type of name</span>
                <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">enumeration</span><span class="o">.</span><span class="n">mro</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">parent</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
                        <span class="n">obj</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">enum_property</span><span class="p">):</span>
                            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%r</span><span class="s1"> already used: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="p">))</span>
                        <span class="k">break</span>
            <span class="n">_member_names_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">_member_map_</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_member</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_value2member_map_</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_member</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">pass</span>

<span class="k">def</span> <span class="nf">unique</span><span class="p">(</span><span class="n">enumeration</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class decorator that ensures only unique members exist in an enumeration.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">duplicates</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">enumeration</span><span class="o">.</span><span class="n">__members__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="n">member</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">duplicates</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">member</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">duplicates</span><span class="p">:</span>
        <span class="n">duplicate_names</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> -&gt; </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="ow">in</span> <span class="n">duplicates</span><span class="p">]</span>
                <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;duplicate names found in </span><span class="si">%r</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                <span class="p">(</span><span class="n">enumeration</span><span class="p">,</span> <span class="n">duplicate_names</span><span class="p">)</span>
                <span class="p">)</span>
    <span class="k">return</span> <span class="n">enumeration</span>

<span class="k">class</span> <span class="nc">Flag</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Support for flags&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_generate_next_value_</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">last_values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate the next value when not given.</span>

<span class="sd">        name: the name of the member</span>
<span class="sd">        start: the initital start value or None</span>
<span class="sd">        count: the number of existing members</span>
<span class="sd">        last_value: the last value assigned or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">count</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">start</span><span class="p">)[</span><span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
        <span class="n">error</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">last_value</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">last_values</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">last_value</span><span class="p">,</span> <span class="n">auto</span><span class="p">):</span>
                <span class="n">last_value</span> <span class="o">=</span> <span class="n">last_value</span><span class="o">.</span><span class="n">value</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">high_bit</span> <span class="o">=</span> <span class="n">_high_bit</span><span class="p">(</span><span class="n">last_value</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">error</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;invalid Flag value: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">last_value</span><span class="p">,</span> <span class="p">))</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">high_bit</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_missing_</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">original_value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="o">~</span><span class="n">value</span>
        <span class="n">possible_member</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_create_pseudo_member_</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">original_value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">possible_member</span> <span class="o">=</span> <span class="o">~</span><span class="n">possible_member</span>
        <span class="k">return</span> <span class="n">possible_member</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_create_pseudo_member_</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a composite member iff value contains only members.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">pseudo_member</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_value2member_map_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pseudo_member</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># verify all bits are accounted for</span>
            <span class="n">members</span><span class="p">,</span> <span class="n">extra_flags</span> <span class="o">=</span> <span class="n">_decompose</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">extra_flags</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%r</span><span class="s2"> is not a valid </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
            <span class="c1"># give subclasses a chance to modify values for new pseudo-member</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_create_pseudo_member_values_</span><span class="p">(</span><span class="n">members</span><span class="p">,</span> <span class="o">*</span><span class="n">values</span><span class="p">)</span>
            <span class="c1"># construct a singleton enum pseudo-member</span>
            <span class="n">pseudo_member</span> <span class="o">=</span> <span class="n">extend_enum</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">values</span><span class="p">,</span> <span class="n">create_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># use setdefault in case another thread already created a composite</span>
            <span class="c1"># with this value</span>
            <span class="n">pseudo_member</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_value2member_map_</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">pseudo_member</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pseudo_member</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_create_pseudo_member_values_</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">members</span><span class="p">,</span> <span class="o">*</span><span class="n">values</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">values</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Flag</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%r</span><span class="s2"> (</span><span class="si">%r</span><span class="s2">) is not an &lt;aenum &#39;Flag&#39;&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">_value_</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value_</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_value_</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">: </span><span class="si">%r</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value_</span><span class="p">)</span>
        <span class="n">members</span><span class="p">,</span> <span class="n">uncovered</span> <span class="o">=</span> <span class="n">_decompose</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value_</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">: </span><span class="si">%r</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">_name_</span> <span class="ow">or</span> <span class="n">m</span><span class="o">.</span><span class="n">_value_</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">members</span><span class="p">]),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_value_</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name_</span><span class="p">)</span>
        <span class="n">members</span><span class="p">,</span> <span class="n">uncovered</span> <span class="o">=</span> <span class="n">_decompose</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value_</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">members</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">members</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_name_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">members</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_value_</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">_name_</span> <span class="ow">or</span> <span class="n">m</span><span class="o">.</span><span class="n">_value_</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">members</span><span class="p">]),</span>
                    <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value_</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pyver</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">__nonzero__</span> <span class="o">=</span> <span class="fm">__bool__</span>
        <span class="k">del</span> <span class="fm">__bool__</span>

    <span class="k">def</span> <span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value_</span> <span class="o">|</span> <span class="n">other</span><span class="o">.</span><span class="n">_value_</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value_</span> <span class="o">&amp;</span> <span class="n">other</span><span class="o">.</span><span class="n">_value_</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__xor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value_</span> <span class="o">^</span> <span class="n">other</span><span class="o">.</span><span class="n">_value_</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__invert__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">members</span><span class="p">,</span> <span class="n">uncovered</span> <span class="o">=</span> <span class="n">_decompose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value_</span><span class="p">)</span>
        <span class="n">inverted_members</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
                <span class="k">if</span> <span class="n">m</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">members</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">m</span><span class="o">.</span><span class="n">_value_</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value_</span>
                <span class="p">]</span>
        <span class="n">inverted</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="n">_or_</span><span class="p">,</span> <span class="n">inverted_members</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">inverted</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">members</span><span class="p">,</span> <span class="n">extra_flags</span> <span class="o">=</span> <span class="n">_decompose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">members</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">_value_</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">IntFlag</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">Flag</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Support for integer-based Flags&quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_missing_</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%r</span><span class="s2"> is not a valid </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
        <span class="n">new_member</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_create_pseudo_member_</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_member</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_create_pseudo_member_</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">pseudo_member</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_value2member_map_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pseudo_member</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">need_to_create</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
            <span class="c1"># get unaccounted for bits</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">extra_flags</span> <span class="o">=</span> <span class="n">_decompose</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">extra_flags</span><span class="p">:</span>
                <span class="n">bit</span> <span class="o">=</span> <span class="n">_high_bit</span><span class="p">(</span><span class="n">extra_flags</span><span class="p">)</span>
                <span class="n">flag_value</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">bit</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">flag_value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_value2member_map_</span> <span class="ow">and</span>
                        <span class="n">flag_value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">need_to_create</span>
                        <span class="p">):</span>
                    <span class="n">need_to_create</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flag_value</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">extra_flags</span> <span class="o">==</span> <span class="o">-</span><span class="n">flag_value</span><span class="p">:</span>
                    <span class="n">extra_flags</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">extra_flags</span> <span class="o">^=</span> <span class="n">flag_value</span>
            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">need_to_create</span><span class="p">):</span>
                <span class="c1"># construct singleton pseudo-members</span>
                <span class="n">pseudo_member</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="n">pseudo_member</span><span class="o">.</span><span class="n">_name_</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">pseudo_member</span><span class="o">.</span><span class="n">_value_</span> <span class="o">=</span> <span class="n">value</span>
                <span class="c1"># use setdefault in case another thread already created a composite</span>
                <span class="c1"># with this value</span>
                <span class="n">pseudo_member</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_value2member_map_</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">pseudo_member</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pseudo_member</span>

    <span class="k">def</span> <span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value_</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">_value_</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value_</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">_value_</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__xor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value_</span> <span class="o">^</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">_value_</span><span class="p">)</span>

    <span class="fm">__ror__</span> <span class="o">=</span> <span class="fm">__or__</span>
    <span class="fm">__rand__</span> <span class="o">=</span> <span class="fm">__and__</span>
    <span class="fm">__rxor__</span> <span class="o">=</span> <span class="fm">__xor__</span>

    <span class="k">def</span> <span class="fm">__invert__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">_value_</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">_high_bit</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;returns index of highest bit, or -1 if value is zero or negative&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">_decompose</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Extract all members from the value.&quot;&quot;&quot;</span>
    <span class="c1"># _decompose is only called if the value is not named</span>
    <span class="n">not_covered</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">negative</span> <span class="o">=</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span>
    <span class="c1"># issue29167: wrap accesses to _value2member_map_ in a list to avoid race</span>
    <span class="c1">#             conditions between iterating over it and having more psuedo-</span>
    <span class="c1">#             members added to it</span>
    <span class="k">if</span> <span class="n">negative</span><span class="p">:</span>
        <span class="c1"># only check for named flags</span>
        <span class="n">flags_to_check</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">flag</span><span class="o">.</span><span class="n">_value2member_map_</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># check for named flags and powers-of-two flags</span>
        <span class="n">flags_to_check</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">flag</span><span class="o">.</span><span class="n">_value2member_map_</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">_power_of_two</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="p">]</span>
    <span class="n">members</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">member</span><span class="p">,</span> <span class="n">member_value</span> <span class="ow">in</span> <span class="n">flags_to_check</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">member_value</span> <span class="ow">and</span> <span class="n">member_value</span> <span class="o">&amp;</span> <span class="n">value</span> <span class="o">==</span> <span class="n">member_value</span><span class="p">:</span>
            <span class="n">members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
            <span class="n">not_covered</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">member_value</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">members</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">flag</span><span class="o">.</span><span class="n">_value2member_map_</span><span class="p">:</span>
        <span class="n">members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flag</span><span class="o">.</span><span class="n">_value2member_map_</span><span class="p">[</span><span class="n">value</span><span class="p">])</span>
    <span class="n">members</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">_value_</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">members</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">members</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
        <span class="c1"># we have the breakdown, don&#39;t need the value member itself</span>
        <span class="n">members</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">members</span><span class="p">,</span> <span class="n">not_covered</span>

<span class="k">def</span> <span class="nf">_power_of_two</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">_high_bit</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">module</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent_module</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__module__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__all__</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">all_objects</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__dict__</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">all_objects</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="n">NamedConstant</span><span class="p">,</span> <span class="n">Enum</span><span class="p">))]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_objects</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__all__</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent_module</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span>


</pre></div>

           </div>
           
          </div>
          <footer>
  <hr />
  
</footer>
        </div>
      </div>

    </section>

  </div>
  

  
  
    
   

</body>
</html>